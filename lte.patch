From 2679613a5850fb042d4f3830be4a64ea027fbbd1 Mon Sep 17 00:00:00 2001
From: cpasjuste <cpasjuste@gmail.com>
Date: Mon, 2 Mar 2015 12:23:32 +0100
Subject: [PATCH 1/6] first cm-12.0 commit

---
 BoardConfigCommon.mk          |  48 ++++---
 include/audio_effects.h       | 283 ------------------------------------------
 include/sound/audio_effects.h | 283 ++++++++++++++++++++++++++++++++++++++++++
 sepolicy/atfwd.te             |   2 +
 sepolicy/bluetooth.te         |   1 +
 sepolicy/file.te              |   8 ++
 sepolicy/file_contexts        |  20 +++
 sepolicy/genfs_contexts       |   2 +
 sepolicy/init.te              |   1 +
 sepolicy/init_shell.te        |   3 +
 sepolicy/mpdecision.te        |   9 ++
 sepolicy/qseecomd.te          |   3 +
 sepolicy/radio.te             |   1 +
 sepolicy/rmt_storage.te       |   9 ++
 sepolicy/sensors.te           |   4 +
 sepolicy/sysinit.te           |   2 +
 sepolicy/system_app.te        |   9 ++
 sepolicy/system_server.te     |   3 +
 sepolicy/tee.te               |   4 +
 sepolicy/thermal-engine.te    |  20 +++
 sepolicy/ueventd.te           |   1 +
 sepolicy/wpa.te               |   4 +
 22 files changed, 421 insertions(+), 299 deletions(-)
 delete mode 100644 include/audio_effects.h
 create mode 100644 include/sound/audio_effects.h
 create mode 100644 sepolicy/atfwd.te
 create mode 100644 sepolicy/bluetooth.te
 create mode 100644 sepolicy/file.te
 create mode 100644 sepolicy/file_contexts
 create mode 100644 sepolicy/genfs_contexts
 create mode 100644 sepolicy/init.te
 create mode 100644 sepolicy/init_shell.te
 create mode 100644 sepolicy/mpdecision.te
 create mode 100644 sepolicy/qseecomd.te
 create mode 100644 sepolicy/radio.te
 create mode 100644 sepolicy/rmt_storage.te
 create mode 100644 sepolicy/sensors.te
 create mode 100644 sepolicy/sysinit.te
 create mode 100644 sepolicy/system_app.te
 create mode 100644 sepolicy/system_server.te
 create mode 100644 sepolicy/tee.te
 create mode 100644 sepolicy/thermal-engine.te
 create mode 100644 sepolicy/ueventd.te
 create mode 100644 sepolicy/wpa.te

diff --git a/BoardConfigCommon.mk b/BoardConfigCommon.mk
index 752279e..cce2d7a 100755
--- a/BoardConfigCommon.mk
+++ b/BoardConfigCommon.mk
@@ -12,12 +12,23 @@ TARGET_BOOTLOADER_BOARD_NAME := MSM8974
 TARGET_NO_BOOTLOADER := true
 
 # Architecture
+TARGET_GLOBAL_CFLAGS += -mfpu=neon-vfpv4 -mfloat-abi=softfp
+TARGET_GLOBAL_CPPFLAGS += -mfpu=neon-vfpv4 -mfloat-abi=softfp
 TARGET_ARCH := arm
 TARGET_CPU_ABI := armeabi-v7a
 TARGET_CPU_ABI2 := armeabi
 TARGET_CPU_SMP := true
 TARGET_ARCH_VARIANT := armv7-a-neon
 TARGET_CPU_VARIANT := krait
+ARCH_ARM_HAVE_TLS_REGISTER := true
+
+# Krait optimizations
+TARGET_USE_KRAIT_BIONIC_OPTIMIZATION := true
+TARGET_USE_KRAIT_PLD_SET := true
+TARGET_KRAIT_BIONIC_PLDOFFS := 10
+TARGET_KRAIT_BIONIC_PLDTHRESH := 10
+TARGET_KRAIT_BIONIC_BBTHRESH := 64
+TARGET_KRAIT_BIONIC_PLDSIZE := 64
 
 # Kernel -> use prebuilt kernel ...
 ifeq ($(TARGET_DEVICE),thor)
@@ -28,25 +39,21 @@ ifeq ($(TARGET_DEVICE),apollo)
 BOARD_KERNEL_CMDLINE := console=ttyHSL0,115200,n8 androidboot.hardware=qcom user_debug=31 msm_rtb.filter=0x37 ehci-hcd.park=3 mdss_mdp.panel=0:qcom,mdss_dsi_jdi_dualmipi0_video:1:qcom,mdss_dsi_jdi_dualmipi1_video: androidboot.selinux=permissive
 BOARD_MKBOOTIMG_ARGS := --ramdisk_offset 0x01000000 --tags_offset 0x00000100
 endif
-
 BOARD_KERNEL_BASE := 0x00000000
 BOARD_KERNEL_PAGESIZE := 2048
 
-
-# Flags for Krait CPU
-TARGET_GLOBAL_CFLAGS += -mfpu=neon-vfpv4 -mfloat-abi=softfp
-TARGET_GLOBAL_CPPFLAGS += -mfpu=neon-vfpv4 -mfloat-abi=softfp
 # Flags
-COMMON_GLOBAL_CFLAGS += -DQCOM_HARDWARE -DQCOM_BSP -DUSE_ION -DAMZ_HDX
+COMMON_GLOBAL_CFLAGS += -DAMZ_HDX
 COMMON_GLOBAL_CFLAGS += -DNO_SECURE_DISCARD
+#-DQCOM_HARDWARE -DQCOM_BSP -DUSE_ION 
 
 # QCOM hardware
-BOARD_USES_QCOM_HARDWARE := true
-TARGET_USES_QCOM_BSP := true
-TARGET_ENABLE_QC_AV_ENHANCEMENTS := true
-TARGET_QCOM_DISPLAY_VARIANT := caf-hdx
-TARGET_QCOM_MEDIA_VARIANT := caf-hdx
-TARGET_QCOM_AUDIO_VARIANT := caf-hdx
+#BOARD_USES_QCOM_HARDWARE := true
+#TARGET_USES_QCOM_BSP := true
+#TARGET_ENABLE_QC_AV_ENHANCEMENTS := true
+#TARGET_QCOM_DISPLAY_VARIANT := caf-hdx
+#TARGET_QCOM_MEDIA_VARIANT := caf-hdx
+#TARGET_QCOM_AUDIO_VARIANT := caf-hdx
 
 # Audio
 AUDIO_FEATURE_DISABLED_SSR := true #MSM CAF
@@ -87,15 +94,16 @@ TARGET_DISPLAY_USE_RETIRE_FENCE := true
 MAX_EGL_CACHE_KEY_SIZE := 12*1024
 MAX_EGL_CACHE_SIZE := 2048*1024
 OVERRIDE_RS_DRIVER := libRSDriver_adreno.so
-#NUM_FRAMEBUFFER_SURFACE_BUFFERS := 3 <- NO
-#TARGET_HAS_OLD_QCOM_ION := true <- NO
-#TARGET_USES_POST_PROCESSING := true <- NO
+
+# Surfaceflinger optimization for VD surfaces
+TARGET_FORCE_HWC_FOR_VIRTUAL_DISPLAYS := true
+NUM_FRAMEBUFFER_SURFACE_BUFFERS := 3
 
 # Power
 #TARGET_POWERHAL_VARIANT := qcom
 
 # Time services
-BOARD_USES_QC_TIME_SERVICES := true
+#BOARD_USES_QC_TIME_SERVICES := true
 
 # Webkit
 ENABLE_WEBGL := true
@@ -169,3 +177,11 @@ TW_CUSTOM_BATTERY_PATH := /sys/class/power_supply/bq27x41
 
 # hdx old bootloader dtb compatibility fix + bootloader signature exploit patch
 BOARD_CUSTOM_BOOTIMG_MK := device/amazon/hdx-common/mkboot.mk
+
+# SELinux policies
+# qcom sepolicy
+include device/qcom/sepolicy/sepolicy.mk
+
+BOARD_SEPOLICY_DIRS += \
+        device/amazon/hdx-common/sepolicy
+
diff --git a/include/audio_effects.h b/include/audio_effects.h
deleted file mode 100644
index 3444477..0000000
--- a/include/audio_effects.h
+++ /dev/null
@@ -1,283 +0,0 @@
-/*
- * Copyright (c) 2013, The Linux Foundation. All rights reserved.
- *
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License version 2 and
- * only version 2 as published by the Free Software Foundation.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- */
-
-#ifndef _AUDIO_EFFECTS_H
-#define _AUDIO_EFFECTS_H
-
-/** AUDIO EFFECTS **/
-
-
-/* CONFIG GET/SET */
-#define CONFIG_CACHE			0
-#define CONFIG_SET			1
-#define CONFIG_GET			2
-
-/* CONFIG HEADER */
-/*
-
-	MODULE_ID,
-	DEVICE,
-	NUM_COMMANDS,
-	COMMAND_ID_1,
-	CONFIG_CACHE/SET/GET,
-	OFFSET_1,
-	LENGTH_1,
-	VALUES_1,
-	...,
-	...,
-	COMMAND_ID_2,
-	CONFIG_CACHE/SET/GET,
-	OFFSET_2,
-	LENGTH_2,
-	VALUES_2,
-	...,
-	...,
-	COMMAND_ID_3,
-	...
-*/
-
-
-/* CONFIG PARAM IDs */
-#define VIRTUALIZER_MODULE		0x00001000
-#define VIRTUALIZER_ENABLE		0x00001001
-#define VIRTUALIZER_STRENGTH		0x00001002
-#define VIRTUALIZER_OUT_TYPE		0x00001003
-#define VIRTUALIZER_GAIN_ADJUST		0x00001004
-#define VIRTUALIZER_ENABLE_PARAM_LEN		1
-#define VIRTUALIZER_STRENGTH_PARAM_LEN		1
-#define VIRTUALIZER_OUT_TYPE_PARAM_LEN		1
-#define VIRTUALIZER_GAIN_ADJUST_PARAM_LEN	1
-
-#define REVERB_MODULE			0x00002000
-#define REVERB_ENABLE			0x00002001
-#define REVERB_MODE			0x00002002
-#define REVERB_PRESET			0x00002003
-#define REVERB_WET_MIX			0x00002004
-#define REVERB_GAIN_ADJUST		0x00002005
-#define REVERB_ROOM_LEVEL		0x00002006
-#define REVERB_ROOM_HF_LEVEL		0x00002007
-#define REVERB_DECAY_TIME		0x00002008
-#define REVERB_DECAY_HF_RATIO		0x00002009
-#define REVERB_REFLECTIONS_LEVEL	0x0000200a
-#define REVERB_REFLECTIONS_DELAY	0x0000200b
-#define REVERB_LEVEL			0x0000200c
-#define REVERB_DELAY			0x0000200d
-#define REVERB_DIFFUSION		0x0000200e
-#define REVERB_DENSITY			0x0000200f
-#define REVERB_ENABLE_PARAM_LEN			1
-#define REVERB_MODE_PARAM_LEN			1
-#define REVERB_PRESET_PARAM_LEN			1
-#define REVERB_WET_MIX_PARAM_LEN		1
-#define REVERB_GAIN_ADJUST_PARAM_LEN		1
-#define REVERB_ROOM_LEVEL_PARAM_LEN		1
-#define REVERB_ROOM_HF_LEVEL_PARAM_LEN		1
-#define REVERB_DECAY_TIME_PARAM_LEN		1
-#define REVERB_DECAY_HF_RATIO_PARAM_LEN		1
-#define REVERB_REFLECTIONS_LEVEL_PARAM_LEN	1
-#define REVERB_REFLECTIONS_DELAY_PARAM_LEN	1
-#define REVERB_LEVEL_PARAM_LEN			1
-#define REVERB_DELAY_PARAM_LEN			1
-#define REVERB_DIFFUSION_PARAM_LEN		1
-#define REVERB_DENSITY_PARAM_LEN		1
-
-#define BASS_BOOST_MODULE		0x00003000
-#define BASS_BOOST_ENABLE		0x00003001
-#define BASS_BOOST_MODE			0x00003002
-#define BASS_BOOST_STRENGTH		0x00003003
-#define BASS_BOOST_ENABLE_PARAM_LEN		1
-#define BASS_BOOST_MODE_PARAM_LEN		1
-#define BASS_BOOST_STRENGTH_PARAM_LEN		1
-
-#define EQ_MODULE			0x00004000
-#define EQ_ENABLE			0x00004001
-#define EQ_CONFIG			0x00004002
-#define EQ_NUM_BANDS			0x00004003
-#define EQ_BAND_LEVELS			0x00004004
-#define EQ_BAND_LEVEL_RANGE		0x00004005
-#define EQ_BAND_FREQS			0x00004006
-#define EQ_SINGLE_BAND_FREQ_RANGE	0x00004007
-#define EQ_SINGLE_BAND_FREQ		0x00004008
-#define EQ_BAND_INDEX			0x00004009
-#define EQ_PRESET_ID			0x0000400a
-#define EQ_NUM_PRESETS			0x0000400b
-#define EQ_PRESET_NAME			0x0000400c
-#define EQ_ENABLE_PARAM_LEN			1
-#define EQ_CONFIG_PARAM_LEN			3
-#define EQ_CONFIG_PER_BAND_PARAM_LEN		5
-#define EQ_NUM_BANDS_PARAM_LEN			1
-#define EQ_BAND_LEVELS_PARAM_LEN		13
-#define EQ_BAND_LEVEL_RANGE_PARAM_LEN		2
-#define EQ_BAND_FREQS_PARAM_LEN			13
-#define EQ_SINGLE_BAND_FREQ_RANGE_PARAM_LEN	2
-#define EQ_SINGLE_BAND_FREQ_PARAM_LEN		1
-#define EQ_BAND_INDEX_PARAM_LEN			1
-#define EQ_PRESET_ID_PARAM_LEN			1
-#define EQ_NUM_PRESETS_PARAM_LEN		1
-#define EQ_PRESET_NAME_PARAM_LEN		32
-
-#define EQ_TYPE_NONE	0
-#define EQ_BASS_BOOST	1
-#define EQ_BASS_CUT	2
-#define EQ_TREBLE_BOOST	3
-#define EQ_TREBLE_CUT	4
-#define EQ_BAND_BOOST	5
-#define EQ_BAND_CUT	6
-
-
-
-#define COMMAND_PAYLOAD_LEN	3
-#define COMMAND_PAYLOAD_SZ	(COMMAND_PAYLOAD_LEN * sizeof(uint32_t))
-#define MAX_INBAND_PARAM_SZ	4096
-#define Q27_UNITY		(1 << 27)
-#define Q8_UNITY		(1 << 8)
-#define CUSTOM_OPENSL_PRESET	18
-
-#define VIRTUALIZER_ENABLE_PARAM_SZ	\
-			(VIRTUALIZER_ENABLE_PARAM_LEN*sizeof(uint32_t))
-#define VIRTUALIZER_STRENGTH_PARAM_SZ	\
-			(VIRTUALIZER_STRENGTH_PARAM_LEN*sizeof(uint32_t))
-#define VIRTUALIZER_OUT_TYPE_PARAM_SZ	\
-			(VIRTUALIZER_OUT_TYPE_PARAM_LEN*sizeof(uint32_t))
-#define VIRTUALIZER_GAIN_ADJUST_PARAM_SZ	\
-			(VIRTUALIZER_GAIN_ADJUST_PARAM_LEN*sizeof(uint32_t))
-struct virtualizer_params {
-	uint32_t device;
-	uint32_t enable_flag;
-	uint32_t strength;
-	uint32_t out_type;
-	int32_t gain_adjust;
-};
-
-#define NUM_OSL_REVERB_PRESETS_SUPPORTED	6
-#define REVERB_ENABLE_PARAM_SZ		\
-			(REVERB_ENABLE_PARAM_LEN*sizeof(uint32_t))
-#define REVERB_MODE_PARAM_SZ		\
-			(REVERB_MODE_PARAM_LEN*sizeof(uint32_t))
-#define REVERB_PRESET_PARAM_SZ		\
-			(REVERB_PRESET_PARAM_LEN*sizeof(uint32_t))
-#define REVERB_WET_MIX_PARAM_SZ		\
-			(REVERB_WET_MIX_PARAM_LEN*sizeof(uint32_t))
-#define REVERB_GAIN_ADJUST_PARAM_SZ	\
-			(REVERB_GAIN_ADJUST_PARAM_LEN*sizeof(uint32_t))
-#define REVERB_ROOM_LEVEL_PARAM_SZ	\
-			(REVERB_ROOM_LEVEL_PARAM_LEN*sizeof(uint32_t))
-#define REVERB_ROOM_HF_LEVEL_PARAM_SZ	\
-			(REVERB_ROOM_HF_LEVEL_PARAM_LEN*sizeof(uint32_t))
-#define REVERB_DECAY_TIME_PARAM_SZ	\
-			(REVERB_DECAY_TIME_PARAM_LEN*sizeof(uint32_t))
-#define REVERB_DECAY_HF_RATIO_PARAM_SZ	\
-			(REVERB_DECAY_HF_RATIO_PARAM_LEN*sizeof(uint32_t))
-#define REVERB_REFLECTIONS_LEVEL_PARAM_SZ	\
-			(REVERB_REFLECTIONS_LEVEL_PARAM_LEN*sizeof(uint32_t))
-#define REVERB_REFLECTIONS_DELAY_PARAM_SZ	\
-			(REVERB_REFLECTIONS_DELAY_PARAM_LEN*sizeof(uint32_t))
-#define REVERB_LEVEL_PARAM_SZ		\
-			(REVERB_LEVEL_PARAM_LEN*sizeof(uint32_t))
-#define REVERB_DELAY_PARAM_SZ		\
-			(REVERB_DELAY_PARAM_LEN*sizeof(uint32_t))
-#define REVERB_DIFFUSION_PARAM_SZ	\
-			(REVERB_DIFFUSION_PARAM_LEN*sizeof(uint32_t))
-#define REVERB_DENSITY_PARAM_SZ		\
-			(REVERB_DENSITY_PARAM_LEN*sizeof(uint32_t))
-struct reverb_params {
-	uint32_t device;
-	uint32_t enable_flag;
-	uint32_t mode;
-	uint32_t preset;
-	uint32_t wet_mix;
-	int32_t  gain_adjust;
-	int32_t  room_level;
-	int32_t  room_hf_level;
-	uint32_t decay_time;
-	uint32_t decay_hf_ratio;
-	int32_t  reflections_level;
-	uint32_t reflections_delay;
-	int32_t  level;
-	uint32_t delay;
-	uint32_t diffusion;
-	uint32_t density;
-};
-
-#define BASS_BOOST_ENABLE_PARAM_SZ	\
-			(BASS_BOOST_ENABLE_PARAM_LEN*sizeof(uint32_t))
-#define BASS_BOOST_MODE_PARAM_SZ	\
-			(BASS_BOOST_MODE_PARAM_LEN*sizeof(uint32_t))
-#define BASS_BOOST_STRENGTH_PARAM_SZ	\
-			(BASS_BOOST_STRENGTH_PARAM_LEN*sizeof(uint32_t))
-struct bass_boost_params {
-	uint32_t device;
-	uint32_t enable_flag;
-	uint32_t mode;
-	uint32_t strength;
-};
-
-
-#define MAX_EQ_BANDS 12
-#define MAX_OSL_EQ_BANDS 5
-#define EQ_ENABLE_PARAM_SZ			\
-			(EQ_ENABLE_PARAM_LEN*sizeof(uint32_t))
-#define EQ_CONFIG_PARAM_SZ			\
-			(EQ_CONFIG_PARAM_LEN*sizeof(uint32_t))
-#define EQ_CONFIG_PER_BAND_PARAM_SZ		\
-			(EQ_CONFIG_PER_BAND_PARAM_LEN*sizeof(uint32_t))
-#define EQ_CONFIG_PARAM_MAX_LEN			(EQ_CONFIG_PARAM_LEN+\
-			MAX_EQ_BANDS*EQ_CONFIG_PER_BAND_PARAM_LEN)
-#define EQ_CONFIG_PARAM_MAX_SZ			\
-			(EQ_CONFIG_PARAM_MAX_LEN*sizeof(uint32_t))
-#define EQ_NUM_BANDS_PARAM_SZ			\
-			(EQ_NUM_BANDS_PARAM_LEN*sizeof(uint32_t))
-#define EQ_BAND_LEVELS_PARAM_SZ			\
-			(EQ_BAND_LEVELS_PARAM_LEN*sizeof(uint32_t))
-#define EQ_BAND_LEVEL_RANGE_PARAM_SZ		\
-			(EQ_BAND_LEVEL_RANGE_PARAM_LEN*sizeof(uint32_t))
-#define EQ_BAND_FREQS_PARAM_SZ			\
-			(EQ_BAND_FREQS_PARAM_LEN*sizeof(uint32_t))
-#define EQ_SINGLE_BAND_FREQ_RANGE_PARAM_SZ	\
-			(EQ_SINGLE_BAND_FREQ_RANGE_PARAM_LEN*sizeof(uint32_t))
-#define EQ_SINGLE_BAND_FREQ_PARAM_SZ		\
-			(EQ_SINGLE_BAND_FREQ_PARAM_LEN*sizeof(uint32_t))
-#define EQ_BAND_INDEX_PARAM_SZ			\
-			(EQ_BAND_INDEX_PARAM_LEN*sizeof(uint32_t))
-#define EQ_PRESET_ID_PARAM_SZ			\
-			(EQ_PRESET_ID_PARAM_LEN*sizeof(uint32_t))
-#define EQ_NUM_PRESETS_PARAM_SZ			\
-			(EQ_NUM_PRESETS_PARAM_LEN*sizeof(uint8_t))
-struct eq_config_t {
-	int32_t eq_pregain;
-	int32_t preset_id;
-	uint32_t num_bands;
-};
-struct eq_per_band_config_t {
-	int32_t band_idx;
-	uint32_t filter_type;
-	uint32_t freq_millihertz;
-	int32_t  gain_millibels;
-	uint32_t quality_factor;
-};
-struct eq_per_band_freq_range_t {
-	uint32_t band_index;
-	uint32_t min_freq_millihertz;
-	uint32_t max_freq_millihertz;
-};
-
-struct eq_params {
-	uint32_t device;
-	uint32_t enable_flag;
-	struct eq_config_t config;
-	struct eq_per_band_config_t per_band_cfg[MAX_EQ_BANDS];
-	struct eq_per_band_freq_range_t per_band_freq_range[MAX_EQ_BANDS];
-	uint32_t band_index;
-	uint32_t freq_millihertz;
-};
-
-#endif /*_MSM_AUDIO_EFFECTS_H*/
diff --git a/include/sound/audio_effects.h b/include/sound/audio_effects.h
new file mode 100644
index 0000000..3444477
--- /dev/null
+++ b/include/sound/audio_effects.h
@@ -0,0 +1,283 @@
+/*
+ * Copyright (c) 2013, The Linux Foundation. All rights reserved.
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License version 2 and
+ * only version 2 as published by the Free Software Foundation.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ */
+
+#ifndef _AUDIO_EFFECTS_H
+#define _AUDIO_EFFECTS_H
+
+/** AUDIO EFFECTS **/
+
+
+/* CONFIG GET/SET */
+#define CONFIG_CACHE			0
+#define CONFIG_SET			1
+#define CONFIG_GET			2
+
+/* CONFIG HEADER */
+/*
+
+	MODULE_ID,
+	DEVICE,
+	NUM_COMMANDS,
+	COMMAND_ID_1,
+	CONFIG_CACHE/SET/GET,
+	OFFSET_1,
+	LENGTH_1,
+	VALUES_1,
+	...,
+	...,
+	COMMAND_ID_2,
+	CONFIG_CACHE/SET/GET,
+	OFFSET_2,
+	LENGTH_2,
+	VALUES_2,
+	...,
+	...,
+	COMMAND_ID_3,
+	...
+*/
+
+
+/* CONFIG PARAM IDs */
+#define VIRTUALIZER_MODULE		0x00001000
+#define VIRTUALIZER_ENABLE		0x00001001
+#define VIRTUALIZER_STRENGTH		0x00001002
+#define VIRTUALIZER_OUT_TYPE		0x00001003
+#define VIRTUALIZER_GAIN_ADJUST		0x00001004
+#define VIRTUALIZER_ENABLE_PARAM_LEN		1
+#define VIRTUALIZER_STRENGTH_PARAM_LEN		1
+#define VIRTUALIZER_OUT_TYPE_PARAM_LEN		1
+#define VIRTUALIZER_GAIN_ADJUST_PARAM_LEN	1
+
+#define REVERB_MODULE			0x00002000
+#define REVERB_ENABLE			0x00002001
+#define REVERB_MODE			0x00002002
+#define REVERB_PRESET			0x00002003
+#define REVERB_WET_MIX			0x00002004
+#define REVERB_GAIN_ADJUST		0x00002005
+#define REVERB_ROOM_LEVEL		0x00002006
+#define REVERB_ROOM_HF_LEVEL		0x00002007
+#define REVERB_DECAY_TIME		0x00002008
+#define REVERB_DECAY_HF_RATIO		0x00002009
+#define REVERB_REFLECTIONS_LEVEL	0x0000200a
+#define REVERB_REFLECTIONS_DELAY	0x0000200b
+#define REVERB_LEVEL			0x0000200c
+#define REVERB_DELAY			0x0000200d
+#define REVERB_DIFFUSION		0x0000200e
+#define REVERB_DENSITY			0x0000200f
+#define REVERB_ENABLE_PARAM_LEN			1
+#define REVERB_MODE_PARAM_LEN			1
+#define REVERB_PRESET_PARAM_LEN			1
+#define REVERB_WET_MIX_PARAM_LEN		1
+#define REVERB_GAIN_ADJUST_PARAM_LEN		1
+#define REVERB_ROOM_LEVEL_PARAM_LEN		1
+#define REVERB_ROOM_HF_LEVEL_PARAM_LEN		1
+#define REVERB_DECAY_TIME_PARAM_LEN		1
+#define REVERB_DECAY_HF_RATIO_PARAM_LEN		1
+#define REVERB_REFLECTIONS_LEVEL_PARAM_LEN	1
+#define REVERB_REFLECTIONS_DELAY_PARAM_LEN	1
+#define REVERB_LEVEL_PARAM_LEN			1
+#define REVERB_DELAY_PARAM_LEN			1
+#define REVERB_DIFFUSION_PARAM_LEN		1
+#define REVERB_DENSITY_PARAM_LEN		1
+
+#define BASS_BOOST_MODULE		0x00003000
+#define BASS_BOOST_ENABLE		0x00003001
+#define BASS_BOOST_MODE			0x00003002
+#define BASS_BOOST_STRENGTH		0x00003003
+#define BASS_BOOST_ENABLE_PARAM_LEN		1
+#define BASS_BOOST_MODE_PARAM_LEN		1
+#define BASS_BOOST_STRENGTH_PARAM_LEN		1
+
+#define EQ_MODULE			0x00004000
+#define EQ_ENABLE			0x00004001
+#define EQ_CONFIG			0x00004002
+#define EQ_NUM_BANDS			0x00004003
+#define EQ_BAND_LEVELS			0x00004004
+#define EQ_BAND_LEVEL_RANGE		0x00004005
+#define EQ_BAND_FREQS			0x00004006
+#define EQ_SINGLE_BAND_FREQ_RANGE	0x00004007
+#define EQ_SINGLE_BAND_FREQ		0x00004008
+#define EQ_BAND_INDEX			0x00004009
+#define EQ_PRESET_ID			0x0000400a
+#define EQ_NUM_PRESETS			0x0000400b
+#define EQ_PRESET_NAME			0x0000400c
+#define EQ_ENABLE_PARAM_LEN			1
+#define EQ_CONFIG_PARAM_LEN			3
+#define EQ_CONFIG_PER_BAND_PARAM_LEN		5
+#define EQ_NUM_BANDS_PARAM_LEN			1
+#define EQ_BAND_LEVELS_PARAM_LEN		13
+#define EQ_BAND_LEVEL_RANGE_PARAM_LEN		2
+#define EQ_BAND_FREQS_PARAM_LEN			13
+#define EQ_SINGLE_BAND_FREQ_RANGE_PARAM_LEN	2
+#define EQ_SINGLE_BAND_FREQ_PARAM_LEN		1
+#define EQ_BAND_INDEX_PARAM_LEN			1
+#define EQ_PRESET_ID_PARAM_LEN			1
+#define EQ_NUM_PRESETS_PARAM_LEN		1
+#define EQ_PRESET_NAME_PARAM_LEN		32
+
+#define EQ_TYPE_NONE	0
+#define EQ_BASS_BOOST	1
+#define EQ_BASS_CUT	2
+#define EQ_TREBLE_BOOST	3
+#define EQ_TREBLE_CUT	4
+#define EQ_BAND_BOOST	5
+#define EQ_BAND_CUT	6
+
+
+
+#define COMMAND_PAYLOAD_LEN	3
+#define COMMAND_PAYLOAD_SZ	(COMMAND_PAYLOAD_LEN * sizeof(uint32_t))
+#define MAX_INBAND_PARAM_SZ	4096
+#define Q27_UNITY		(1 << 27)
+#define Q8_UNITY		(1 << 8)
+#define CUSTOM_OPENSL_PRESET	18
+
+#define VIRTUALIZER_ENABLE_PARAM_SZ	\
+			(VIRTUALIZER_ENABLE_PARAM_LEN*sizeof(uint32_t))
+#define VIRTUALIZER_STRENGTH_PARAM_SZ	\
+			(VIRTUALIZER_STRENGTH_PARAM_LEN*sizeof(uint32_t))
+#define VIRTUALIZER_OUT_TYPE_PARAM_SZ	\
+			(VIRTUALIZER_OUT_TYPE_PARAM_LEN*sizeof(uint32_t))
+#define VIRTUALIZER_GAIN_ADJUST_PARAM_SZ	\
+			(VIRTUALIZER_GAIN_ADJUST_PARAM_LEN*sizeof(uint32_t))
+struct virtualizer_params {
+	uint32_t device;
+	uint32_t enable_flag;
+	uint32_t strength;
+	uint32_t out_type;
+	int32_t gain_adjust;
+};
+
+#define NUM_OSL_REVERB_PRESETS_SUPPORTED	6
+#define REVERB_ENABLE_PARAM_SZ		\
+			(REVERB_ENABLE_PARAM_LEN*sizeof(uint32_t))
+#define REVERB_MODE_PARAM_SZ		\
+			(REVERB_MODE_PARAM_LEN*sizeof(uint32_t))
+#define REVERB_PRESET_PARAM_SZ		\
+			(REVERB_PRESET_PARAM_LEN*sizeof(uint32_t))
+#define REVERB_WET_MIX_PARAM_SZ		\
+			(REVERB_WET_MIX_PARAM_LEN*sizeof(uint32_t))
+#define REVERB_GAIN_ADJUST_PARAM_SZ	\
+			(REVERB_GAIN_ADJUST_PARAM_LEN*sizeof(uint32_t))
+#define REVERB_ROOM_LEVEL_PARAM_SZ	\
+			(REVERB_ROOM_LEVEL_PARAM_LEN*sizeof(uint32_t))
+#define REVERB_ROOM_HF_LEVEL_PARAM_SZ	\
+			(REVERB_ROOM_HF_LEVEL_PARAM_LEN*sizeof(uint32_t))
+#define REVERB_DECAY_TIME_PARAM_SZ	\
+			(REVERB_DECAY_TIME_PARAM_LEN*sizeof(uint32_t))
+#define REVERB_DECAY_HF_RATIO_PARAM_SZ	\
+			(REVERB_DECAY_HF_RATIO_PARAM_LEN*sizeof(uint32_t))
+#define REVERB_REFLECTIONS_LEVEL_PARAM_SZ	\
+			(REVERB_REFLECTIONS_LEVEL_PARAM_LEN*sizeof(uint32_t))
+#define REVERB_REFLECTIONS_DELAY_PARAM_SZ	\
+			(REVERB_REFLECTIONS_DELAY_PARAM_LEN*sizeof(uint32_t))
+#define REVERB_LEVEL_PARAM_SZ		\
+			(REVERB_LEVEL_PARAM_LEN*sizeof(uint32_t))
+#define REVERB_DELAY_PARAM_SZ		\
+			(REVERB_DELAY_PARAM_LEN*sizeof(uint32_t))
+#define REVERB_DIFFUSION_PARAM_SZ	\
+			(REVERB_DIFFUSION_PARAM_LEN*sizeof(uint32_t))
+#define REVERB_DENSITY_PARAM_SZ		\
+			(REVERB_DENSITY_PARAM_LEN*sizeof(uint32_t))
+struct reverb_params {
+	uint32_t device;
+	uint32_t enable_flag;
+	uint32_t mode;
+	uint32_t preset;
+	uint32_t wet_mix;
+	int32_t  gain_adjust;
+	int32_t  room_level;
+	int32_t  room_hf_level;
+	uint32_t decay_time;
+	uint32_t decay_hf_ratio;
+	int32_t  reflections_level;
+	uint32_t reflections_delay;
+	int32_t  level;
+	uint32_t delay;
+	uint32_t diffusion;
+	uint32_t density;
+};
+
+#define BASS_BOOST_ENABLE_PARAM_SZ	\
+			(BASS_BOOST_ENABLE_PARAM_LEN*sizeof(uint32_t))
+#define BASS_BOOST_MODE_PARAM_SZ	\
+			(BASS_BOOST_MODE_PARAM_LEN*sizeof(uint32_t))
+#define BASS_BOOST_STRENGTH_PARAM_SZ	\
+			(BASS_BOOST_STRENGTH_PARAM_LEN*sizeof(uint32_t))
+struct bass_boost_params {
+	uint32_t device;
+	uint32_t enable_flag;
+	uint32_t mode;
+	uint32_t strength;
+};
+
+
+#define MAX_EQ_BANDS 12
+#define MAX_OSL_EQ_BANDS 5
+#define EQ_ENABLE_PARAM_SZ			\
+			(EQ_ENABLE_PARAM_LEN*sizeof(uint32_t))
+#define EQ_CONFIG_PARAM_SZ			\
+			(EQ_CONFIG_PARAM_LEN*sizeof(uint32_t))
+#define EQ_CONFIG_PER_BAND_PARAM_SZ		\
+			(EQ_CONFIG_PER_BAND_PARAM_LEN*sizeof(uint32_t))
+#define EQ_CONFIG_PARAM_MAX_LEN			(EQ_CONFIG_PARAM_LEN+\
+			MAX_EQ_BANDS*EQ_CONFIG_PER_BAND_PARAM_LEN)
+#define EQ_CONFIG_PARAM_MAX_SZ			\
+			(EQ_CONFIG_PARAM_MAX_LEN*sizeof(uint32_t))
+#define EQ_NUM_BANDS_PARAM_SZ			\
+			(EQ_NUM_BANDS_PARAM_LEN*sizeof(uint32_t))
+#define EQ_BAND_LEVELS_PARAM_SZ			\
+			(EQ_BAND_LEVELS_PARAM_LEN*sizeof(uint32_t))
+#define EQ_BAND_LEVEL_RANGE_PARAM_SZ		\
+			(EQ_BAND_LEVEL_RANGE_PARAM_LEN*sizeof(uint32_t))
+#define EQ_BAND_FREQS_PARAM_SZ			\
+			(EQ_BAND_FREQS_PARAM_LEN*sizeof(uint32_t))
+#define EQ_SINGLE_BAND_FREQ_RANGE_PARAM_SZ	\
+			(EQ_SINGLE_BAND_FREQ_RANGE_PARAM_LEN*sizeof(uint32_t))
+#define EQ_SINGLE_BAND_FREQ_PARAM_SZ		\
+			(EQ_SINGLE_BAND_FREQ_PARAM_LEN*sizeof(uint32_t))
+#define EQ_BAND_INDEX_PARAM_SZ			\
+			(EQ_BAND_INDEX_PARAM_LEN*sizeof(uint32_t))
+#define EQ_PRESET_ID_PARAM_SZ			\
+			(EQ_PRESET_ID_PARAM_LEN*sizeof(uint32_t))
+#define EQ_NUM_PRESETS_PARAM_SZ			\
+			(EQ_NUM_PRESETS_PARAM_LEN*sizeof(uint8_t))
+struct eq_config_t {
+	int32_t eq_pregain;
+	int32_t preset_id;
+	uint32_t num_bands;
+};
+struct eq_per_band_config_t {
+	int32_t band_idx;
+	uint32_t filter_type;
+	uint32_t freq_millihertz;
+	int32_t  gain_millibels;
+	uint32_t quality_factor;
+};
+struct eq_per_band_freq_range_t {
+	uint32_t band_index;
+	uint32_t min_freq_millihertz;
+	uint32_t max_freq_millihertz;
+};
+
+struct eq_params {
+	uint32_t device;
+	uint32_t enable_flag;
+	struct eq_config_t config;
+	struct eq_per_band_config_t per_band_cfg[MAX_EQ_BANDS];
+	struct eq_per_band_freq_range_t per_band_freq_range[MAX_EQ_BANDS];
+	uint32_t band_index;
+	uint32_t freq_millihertz;
+};
+
+#endif /*_MSM_AUDIO_EFFECTS_H*/
diff --git a/sepolicy/atfwd.te b/sepolicy/atfwd.te
new file mode 100644
index 0000000..8e09aca
--- /dev/null
+++ b/sepolicy/atfwd.te
@@ -0,0 +1,2 @@
+allow atfwd ctl_default_prop:property_service set;
+
diff --git a/sepolicy/bluetooth.te b/sepolicy/bluetooth.te
new file mode 100644
index 0000000..cb3f9fe
--- /dev/null
+++ b/sepolicy/bluetooth.te
@@ -0,0 +1 @@
+allow bluetooth btlock_file:chr_file rw_file_perms;
diff --git a/sepolicy/file.te b/sepolicy/file.te
new file mode 100644
index 0000000..c5f68b2
--- /dev/null
+++ b/sepolicy/file.te
@@ -0,0 +1,8 @@
+type encrypt_block_device, dev_type;
+type misc_block_device, dev_type;
+type rfkill_device, dev_type;
+type mpdecision_data, file_type;
+type btlock_file, dev_type;
+type touchpanel_sysfs, fs_type, sysfs_type;
+type vibeamp_sysfs, sysfs_type, file_type;
+type kcal_sysfs, sysfs_type, file_type;
diff --git a/sepolicy/file_contexts b/sepolicy/file_contexts
new file mode 100644
index 0000000..af3a9d5
--- /dev/null
+++ b/sepolicy/file_contexts
@@ -0,0 +1,20 @@
+/dev/block/platform/msm_sdcc\.1/by-name/encrypt     u:object_r:encrypt_block_device:s0
+/dev/block/platform/msm_sdcc\.1/by-name/misc        u:object_r:misc_block_device:s0
+
+/sys/devices/platform/kcal_ctrl\.0/kcal.*            u:object_r:kcal_sysfs:s0
+
+
+/sys/devices/virtual/input/lge_touch(/.*)?          u:object_r:touchpanel_sysfs:s0
+/sys/devices/platform/tspdrv/nforce_timed           u:object_r:vibeamp_sysfs:s0
+
+
+/data/app/sensor_ctl_socket           u:object_r:sensors_socket:s0
+/dev/rfkill                           u:object_r:rfkill_device:s0
+/sns(/.*)?                            u:object_r:sensors_persist_file:s0
+/data/system/default_values           u:object_r:mpdecision_data:s0
+/dev/btlock                           u:object_r:btlock_file:s0
+
+/dev/bcm2079x                         u:object_r:nfc_device:s0
+/dev/socket/mpdecision(/.*)?          u:object_r:mpctl_socket:s0
+/data/cam_socket.*                    u:object_r:camera_socket:s0
+
diff --git a/sepolicy/genfs_contexts b/sepolicy/genfs_contexts
new file mode 100644
index 0000000..51f0c78
--- /dev/null
+++ b/sepolicy/genfs_contexts
@@ -0,0 +1,2 @@
+genfscon proc /bluetooth/sleep/lpm     u:object_r:proc_bluetooth_writable:s0
+genfscon proc /bluetooth/sleep/btwrite u:object_r:proc_bluetooth_writable:s0
diff --git a/sepolicy/init.te b/sepolicy/init.te
new file mode 100644
index 0000000..54d0433
--- /dev/null
+++ b/sepolicy/init.te
@@ -0,0 +1 @@
+allow init shell_data_file:fifo_file getattr;
diff --git a/sepolicy/init_shell.te b/sepolicy/init_shell.te
new file mode 100644
index 0000000..24b86d0
--- /dev/null
+++ b/sepolicy/init_shell.te
@@ -0,0 +1,3 @@
+allow init_shell vfat:dir read;
+allow init_shell vfat:dir open;
+allow init_shell vfat:file getattr;
diff --git a/sepolicy/mpdecision.te b/sepolicy/mpdecision.te
new file mode 100644
index 0000000..3015aac
--- /dev/null
+++ b/sepolicy/mpdecision.te
@@ -0,0 +1,9 @@
+allow mpdecision self:process execmem;
+
+type_transition mpdecision socket_device:sock_file mpctl_socket;
+
+allow mpdecision socket_device:dir add_name;
+
+allow mpdecision mpdecision_data:file { rw_file_perms };
+
+binder_use(mpdecision)
diff --git a/sepolicy/qseecomd.te b/sepolicy/qseecomd.te
new file mode 100644
index 0000000..7737a4f
--- /dev/null
+++ b/sepolicy/qseecomd.te
@@ -0,0 +1,3 @@
+allow tee encrypt_block_device:blk_file rw_file_perms;
+# This is shared with vold...
+allow vold encrypt_block_device:blk_file rw_file_perms;
diff --git a/sepolicy/radio.te b/sepolicy/radio.te
new file mode 100644
index 0000000..4d21a76
--- /dev/null
+++ b/sepolicy/radio.te
@@ -0,0 +1 @@
+allow radio touchpanel_sysfs:file rw_file_perms;
diff --git a/sepolicy/rmt_storage.te b/sepolicy/rmt_storage.te
new file mode 100644
index 0000000..12cd864
--- /dev/null
+++ b/sepolicy/rmt_storage.te
@@ -0,0 +1,9 @@
+typeattribute rmt_storage rmt_placeholder;
+
+allow rmt_storage ssd_device:blk_file rw_file_perms;
+
+allow rmt_storage block_device:dir search;
+allow rmt_storage kmem_device:chr_file rw_file_perms;
+allow rmt_storage self:capability sys_rawio;
+allow rmt_storage self:process execmem;
+allow rmt_storage self:capability dac_override;
diff --git a/sepolicy/sensors.te b/sepolicy/sensors.te
new file mode 100644
index 0000000..4ea161b
--- /dev/null
+++ b/sepolicy/sensors.te
@@ -0,0 +1,4 @@
+# Stupid blob uses /data/app for the socket, allow creation...
+allow sensors apk_data_file:dir { write remove_name add_name };
+
+type_transition sensors apk_data_file:sock_file sensors_socket "sensor_ctl_socket";
diff --git a/sepolicy/sysinit.te b/sepolicy/sysinit.te
new file mode 100644
index 0000000..96f6a53
--- /dev/null
+++ b/sepolicy/sysinit.te
@@ -0,0 +1,2 @@
+allow sysinit self:capability dac_override;
+allow sysinit userinit_exec:file { read getattr open execute execute_no_trans };
diff --git a/sepolicy/system_app.te b/sepolicy/system_app.te
new file mode 100644
index 0000000..4848343
--- /dev/null
+++ b/sepolicy/system_app.te
@@ -0,0 +1,9 @@
+# for Settings' access to TapToWake
+allow system_app touchpanel_sysfs:file rw_file_perms;
+allow system_app touchpanel_sysfs:dir { search };
+
+# for Settings' access to VibratorHW
+allow system_app vibeamp_sysfs:file rw_file_perms;
+
+# for Settings' access to DisplayCalibration
+allow system_app kcal_sysfs:file rw_file_perms;
diff --git a/sepolicy/system_server.te b/sepolicy/system_server.te
new file mode 100644
index 0000000..24604b3
--- /dev/null
+++ b/sepolicy/system_server.te
@@ -0,0 +1,3 @@
+allow system_server sensors_data_file:sock_file { getattr rw_file_perms };
+allow system_server sensors_data_file:dir search;
+allow system_server time_daemon:unix_stream_socket connectto;
diff --git a/sepolicy/tee.te b/sepolicy/tee.te
new file mode 100644
index 0000000..fa01ee6
--- /dev/null
+++ b/sepolicy/tee.te
@@ -0,0 +1,4 @@
+allow tee shell_data_file:dir { write add_name };
+allow tee shell_data_file:fifo_file { create setattr };
+allow tee vfat:file { read getattr open };
+
diff --git a/sepolicy/thermal-engine.te b/sepolicy/thermal-engine.te
new file mode 100644
index 0000000..f339e1a
--- /dev/null
+++ b/sepolicy/thermal-engine.te
@@ -0,0 +1,20 @@
+# Access /sys/devices/system/cpu/
+allow thermal-engine sysfs_devices_system_cpu:file rw_file_perms;
+
+binder_use(thermal-engine)
+
+# Some files in /sys/devices/system/cpu may pop in and out of existance,
+# defeating our attempt to label them. As a result, they could have the
+# sysfs label, not the sysfs_devices_system_cpu label.
+# Allow write access for now until we figure out a better solution.
+# For example, the following files pop in and out of existance:
+# /sys/devices/system/cpu/cpu1/cpufreq/cpuinfo_min_freq
+# /sys/devices/system/cpu/cpu1/cpufreq/scaling_min_freq
+allow thermal-engine sysfs:file write;
+
+allow thermal-engine self:capability { dac_override net_admin };
+
+allow thermal-engine self:netlink_kobject_uevent_socket { create setopt bind read };
+allow thermal-engine sysfs:file write;
+
+allow thermal-engine mpctl_socket:dir w_dir_perms;
diff --git a/sepolicy/ueventd.te b/sepolicy/ueventd.te
new file mode 100644
index 0000000..bbe021c
--- /dev/null
+++ b/sepolicy/ueventd.te
@@ -0,0 +1 @@
+allow ueventd vfat:file { read getattr open };
diff --git a/sepolicy/wpa.te b/sepolicy/wpa.te
new file mode 100644
index 0000000..790eb80
--- /dev/null
+++ b/sepolicy/wpa.te
@@ -0,0 +1,4 @@
+allow wpa rfkill_device:chr_file rw_file_perms;
+allow wpa block_device:dir search;
+allow wpa misc_block_device:blk_file { getattr rw_file_perms };
+
-- 
1.9.1


From 06ddd8c42f0a66f135a42e0fcebf2bc6514079e9 Mon Sep 17 00:00:00 2001
From: cpasjuste <cpasjuste@gmail.com>
Date: Mon, 2 Mar 2015 13:54:16 +0100
Subject: [PATCH 2/6] hw: qcom: fix libqc-opt.so ?

---
 hdx-common.mk                 |   5 +++++
 overlay-binaries/libqc-opt.so | Bin 0 -> 9728 bytes
 2 files changed, 5 insertions(+)
 create mode 100644 overlay-binaries/libqc-opt.so

diff --git a/hdx-common.mk b/hdx-common.mk
index bc4b92e..4aa745c 100755
--- a/hdx-common.mk
+++ b/hdx-common.mk
@@ -54,6 +54,11 @@ PRODUCT_PACKAGES += \
 	ueventd.qcom.rc \
 	init.recovery.qcom.rc
 
+# fix libqc-opt.so (missing "utext_openUChars_51" import from stagefright 4.X)
+# https://github.com/TheMuppets/proprietary_vendor_samsung/blob/cm-12.0/d2-common/proprietary/lib/libqc-opt.so
+PRODUCT_COPY_FILES += \
+	$(COMMON_FOLDER)/overlay-binaries/libqc-opt.so:system/vendor/lib/libqc-opt.so	
+
 # Audio
 PRODUCT_PACKAGES += \
     audio.a2dp.default \
diff --git a/overlay-binaries/libqc-opt.so b/overlay-binaries/libqc-opt.so
new file mode 100644
index 0000000000000000000000000000000000000000..d3250aadf52d7db5f1b7fbe4ee46dc5b24ac6e47
GIT binary patch
literal 9728
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
Pk?s)e{?#x7H|+ig^F#w9

literal 0
HcmV?d00001

-- 
1.9.1


From 25e860e02ffed06ca4fe8febcae968c7624e3346 Mon Sep 17 00:00:00 2001
From: cpasjuste <cpasjuste@gmail.com>
Date: Mon, 2 Mar 2015 14:06:22 +0100
Subject: [PATCH 3/6] libstagefright: fix missing symbol

---
 BoardConfigCommon.mk | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/BoardConfigCommon.mk b/BoardConfigCommon.mk
index cce2d7a..47b9cd1 100755
--- a/BoardConfigCommon.mk
+++ b/BoardConfigCommon.mk
@@ -43,7 +43,7 @@ BOARD_KERNEL_BASE := 0x00000000
 BOARD_KERNEL_PAGESIZE := 2048
 
 # Flags
-COMMON_GLOBAL_CFLAGS += -DAMZ_HDX
+COMMON_GLOBAL_CFLAGS += -DAMZ_HDX -DADD_LEGACY_ACQUIRE_BUFFER_SYMBOL
 COMMON_GLOBAL_CFLAGS += -DNO_SECURE_DISCARD
 #-DQCOM_HARDWARE -DQCOM_BSP -DUSE_ION 
 
-- 
1.9.1


From 532b40c03b50cc629492949ad4f0f1240623b934 Mon Sep 17 00:00:00 2001
From: cpasjuste <cpasjuste@gmail.com>
Date: Tue, 3 Mar 2015 13:00:35 +0100
Subject: [PATCH 4/6] add more sepolicy fix

---
 hdx-common.mk             | 1 +
 sepolicy/init_shell.te    | 7 +++++++
 sepolicy/system_server.te | 1 +
 sepolicy/tee.te           | 7 +++++++
 4 files changed, 16 insertions(+)

diff --git a/hdx-common.mk b/hdx-common.mk
index 4aa745c..762d6aa 100755
--- a/hdx-common.mk
+++ b/hdx-common.mk
@@ -139,6 +139,7 @@ PRODUCT_PACKAGES += \
     com.android.future.usb.accessory
 
 PRODUCT_PACKAGES += \
+	wpa_supplicant \
     wpa_supplicant_overlay.conf \
     p2p_supplicant_overlay.conf \
     hostapd_default.conf \
diff --git a/sepolicy/init_shell.te b/sepolicy/init_shell.te
index 24b86d0..3eb12be 100644
--- a/sepolicy/init_shell.te
+++ b/sepolicy/init_shell.te
@@ -1,3 +1,10 @@
 allow init_shell vfat:dir read;
 allow init_shell vfat:dir open;
 allow init_shell vfat:file getattr;
+allow init_shell kernel:process setsched;
+
+# allow init_shell block_device:blk_file { read ioctl open }; # libsepol.check_assertion_helper: neverallow on line 254 of external/sepolicy/domain.te (or line 5252 of policy.conf) violated by allow init_shell block_device:blk_file { read open }; 
+# allow init_shell labeledfs:filesystem remount; #libsepol.check_assertion_helper: neverallow on line 264 of external/sepolicy/domain.te (or line 5262 of policy.conf) violated by allow init_shell labeledfs:filesystem { remount }; 
+#allow init_shell system_file:lnk_file create; # libsepol.check_assertion_helper: neverallow on line 291 of external/sepolicy/domain.te (or line 5289 of policy.conf) violated by allow init_shell system_file:lnk_file { create }; 
+#allow init_shell system_file:dir { write add_name }; # libsepol.check_assertion_helper: neverallow on line 291 of external/sepolicy/domain.te (or line 5289 of policy.conf) violated by allow init_shell system_file:dir { write };
+#allow init_shell system_file:file create; # libsepol.check_assertion_helper: neverallow on line 291 of external/sepolicy/domain.te (or line 5289 of policy.conf) violated by allow init_shell system_file:file { create };
diff --git a/sepolicy/system_server.te b/sepolicy/system_server.te
index 24604b3..fda6e36 100644
--- a/sepolicy/system_server.te
+++ b/sepolicy/system_server.te
@@ -1,3 +1,4 @@
 allow system_server sensors_data_file:sock_file { getattr rw_file_perms };
 allow system_server sensors_data_file:dir search;
 allow system_server time_daemon:unix_stream_socket connectto;
+allow system_server default_prop:property_service set;
diff --git a/sepolicy/tee.te b/sepolicy/tee.te
index fa01ee6..5cdc6bc 100644
--- a/sepolicy/tee.te
+++ b/sepolicy/tee.te
@@ -1,3 +1,10 @@
+# Qualcomm Secure Execution Environment Communicator policy
+allow tee self:process execmem;
+
+allow tee persist_file:dir search;
+allow tee persist_drm_file:dir r_dir_perms;
+allow tee persist_drm_file:file r_file_perms;
+
 allow tee shell_data_file:dir { write add_name };
 allow tee shell_data_file:fifo_file { create setattr };
 allow tee vfat:file { read getattr open };
-- 
1.9.1


From 5e36dbdce9dfb1771ea94afe7d35bac4daa977af Mon Sep 17 00:00:00 2001
From: cpasjuste <cpasjuste@gmail.com>
Date: Tue, 3 Mar 2015 14:10:03 +0100
Subject: [PATCH 5/6] -switch to cm qcom power

---
 BoardConfigCommon.mk | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/BoardConfigCommon.mk b/BoardConfigCommon.mk
index 47b9cd1..afc7dd9 100755
--- a/BoardConfigCommon.mk
+++ b/BoardConfigCommon.mk
@@ -100,7 +100,7 @@ TARGET_FORCE_HWC_FOR_VIRTUAL_DISPLAYS := true
 NUM_FRAMEBUFFER_SURFACE_BUFFERS := 3
 
 # Power
-#TARGET_POWERHAL_VARIANT := qcom
+TARGET_POWERHAL_VARIANT := qcom
 
 # Time services
 #BOARD_USES_QC_TIME_SERVICES := true
-- 
1.9.1


From f2e7162d16cd70a968279e0d8d11ee1f6fe09c55 Mon Sep 17 00:00:00 2001
From: cpasjuste <cpasjuste@gmail.com>
Date: Fri, 6 Mar 2015 20:09:57 +0100
Subject: [PATCH 6/6] testing

---
 BoardConfigCommon.mk                               |  25 +-
 configs/audio_effects.conf                         | 260 +++++++++++++
 configs/audio_policy.conf                          | 107 ++++++
 configs/media_codecs.xml                           | 115 ++++++
 configs/media_profiles.xml                         | 428 +++++++++++++++++++++
 hdx-common.mk                                      |  72 ++--
 .../frameworks/base/core/res/res/values/config.xml |  10 +-
 7 files changed, 958 insertions(+), 59 deletions(-)
 create mode 100644 configs/audio_effects.conf
 create mode 100644 configs/audio_policy.conf
 create mode 100644 configs/media_codecs.xml
 create mode 100644 configs/media_profiles.xml

diff --git a/BoardConfigCommon.mk b/BoardConfigCommon.mk
index afc7dd9..642d13a 100755
--- a/BoardConfigCommon.mk
+++ b/BoardConfigCommon.mk
@@ -56,22 +56,23 @@ COMMON_GLOBAL_CFLAGS += -DNO_SECURE_DISCARD
 #TARGET_QCOM_AUDIO_VARIANT := caf-hdx
 
 # Audio
-AUDIO_FEATURE_DISABLED_SSR := true #MSM CAF
+#AUDIO_FEATURE_DISABLED_SSR := true #MSM CAF
 BOARD_USES_ALSA_AUDIO := true
-BOARD_USES_LEGACY_ALSA_AUDIO := false
+#BOARD_USES_LEGACY_ALSA_AUDIO := false
 # test
-AUDIO_FEATURE_ENABLED_COMPRESS_VOIP := true
-AUDIO_FEATURE_ENABLED_EXTN_FORMATS := true
+#AUDIO_FEATURE_ENABLED_COMPRESS_VOIP := true
+#AUDIO_FEATURE_ENABLED_EXTN_FORMATS := true
 AUDIO_FEATURE_ENABLED_FLUENCE := true
-AUDIO_FEATURE_ENABLED_INCALL_MUSIC := true
-AUDIO_FEATURE_ENABLED_MULTI_VOICE_SESSIONS := true
-AUDIO_FEATURE_ENABLED_PCM_OFFLOAD := true
-AUDIO_FEATURE_ENABLED_PROXY_DEVICE := true
+#AUDIO_FEATURE_ENABLED_INCALL_MUSIC := true
+#AUDIO_FEATURE_ENABLED_MULTI_VOICE_SESSIONS := true
+#AUDIO_FEATURE_ENABLED_PCM_OFFLOAD := true
+#AUDIO_FEATURE_ENABLED_PROXY_DEVICE := true
 BOARD_USES_FLUENCE_INCALL := true
-BOARD_USES_SEPERATED_AUDIO_INPUT := true
-BOARD_USES_SEPERATED_VOICE_SPEAKER := true
+#BOARD_USES_SEPERATED_AUDIO_INPUT := true
+#BOARD_USES_SEPERATED_VOICE_SPEAKER := true
 TARGET_USES_QCOM_COMPRESSED_AUDIO := true
-TARGET_USES_QCOM_MM_AUDIO := true
+BOARD_HAVE_LOW_LATENCY_AUDIO := true
+#TARGET_USES_QCOM_MM_AUDIO := true
 # test
 
 # Bluetooth
@@ -97,7 +98,7 @@ OVERRIDE_RS_DRIVER := libRSDriver_adreno.so
 
 # Surfaceflinger optimization for VD surfaces
 TARGET_FORCE_HWC_FOR_VIRTUAL_DISPLAYS := true
-NUM_FRAMEBUFFER_SURFACE_BUFFERS := 3
+#NUM_FRAMEBUFFER_SURFACE_BUFFERS := 3
 
 # Power
 TARGET_POWERHAL_VARIANT := qcom
diff --git a/configs/audio_effects.conf b/configs/audio_effects.conf
new file mode 100644
index 0000000..ab862d8
--- /dev/null
+++ b/configs/audio_effects.conf
@@ -0,0 +1,260 @@
+# List of effect libraries to load. Each library element must contain a "path" element
+# giving the full path of the library .so file.
+#    libraries {
+#        <lib name> {
+#          path <lib path>
+#        }
+#    }
+libraries {
+  bundle {
+    path /system/lib/soundfx/libbundlewrapper.so
+  }
+  reverb {
+    path /system/lib/soundfx/libreverbwrapper.so
+  }
+  visualizer_sw {
+    path /system/lib/soundfx/libvisualizer.so
+  }
+  visualizer_hw {
+    path /system/lib/soundfx/libqcomvisualizer.so
+  }
+  downmix {
+    path /system/lib/soundfx/libdownmix.so
+  }
+  proxy {
+    path /system/lib/soundfx/libeffectproxy.so
+  }
+  offload_bundle {
+    path /system/lib/soundfx/libqcompostprocbundle.so
+  }
+  loudness_enhancer {
+    path /system/lib/soundfx/libldnhncr.so
+  }
+}
+
+# Default pre-processing library. Add to audio_effect.conf "libraries" section if
+# audio HAL implements support for default software audio pre-processing effects
+#
+#  pre_processing {
+#    path /system/lib/soundfx/libaudiopreprocessing.so
+#  }
+
+# list of effects to load. Each effect element must contain a "library" and a "uuid" element.
+# The value of the "library" element must correspond to the name of one library element in the
+# "libraries" element.
+# The name of the effect element is indicative, only the value of the "uuid" element
+# designates the effect.
+# The uuid is the implementation specific UUID as specified by the effect vendor. This is not the
+# generic effect type UUID.
+#    effects {
+#        <fx name> {
+#            library <lib name>
+#            uuid <effect uuid>
+#        }
+#        ...
+#    }
+
+effects {
+
+# additions for the proxy implementation
+# Proxy implementation
+  #effectname {
+    #library proxy
+    #uuid  xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
+
+    # SW implemetation of the effect. Added as a node under the proxy to
+    # indicate this as a sub effect.
+      #libsw {
+         #library libSW
+         #uuid  yyyyyyyy-yyyy-yyyy-yyyy-yyyyyyyyyyyy
+      #} End of SW effect
+
+    # HW implementation of the effect. Added as a node under the proxy to
+    # indicate this as a sub effect.
+      #libhw {
+         #library libHW
+         #uuid  zzzzzzzz-zzzz-zzzz-zzzz-zzzzzzzzzzzz
+      #}End of HW effect
+  #} End of effect proxy
+
+  bassboost {
+    library proxy
+    uuid 14804144-a5ee-4d24-aa88-0002a5d5c51b
+
+    libsw {
+      library bundle
+      uuid 8631f300-72e2-11df-b57e-0002a5d5c51b
+    }
+
+    libhw {
+      library offload_bundle
+      uuid 2c4a8c24-1581-487f-94f6-0002a5d5c51b
+    }
+  }
+  virtualizer {
+    library proxy
+    uuid d3467faa-acc7-4d34-acaf-0002a5d5c51b
+
+    libsw {
+      library bundle
+      uuid 1d4033c0-8557-11df-9f2d-0002a5d5c51b
+    }
+
+    libhw {
+      library offload_bundle
+      uuid 509a4498-561a-4bea-b3b1-0002a5d5c51b
+    }
+  }
+  equalizer {
+    library proxy
+    uuid c8e70ecd-48ca-456e-8a4f-0002a5d5c51b
+
+    libsw {
+      library bundle
+      uuid ce772f20-847d-11df-bb17-0002a5d5c51b
+    }
+
+    libhw {
+      library offload_bundle
+      uuid a0dac280-401c-11e3-9379-0002a5d5c51b
+    }
+  }
+  volume {
+    library bundle
+    uuid 119341a0-8469-11df-81f9-0002a5d5c51b
+  }
+  reverb_env_aux {
+    library proxy
+    uuid 48404ac9-d202-4ccc-bf84-0002a5d5c51b
+
+    libsw {
+      library reverb
+      uuid 4a387fc0-8ab3-11df-8bad-0002a5d5c51b
+    }
+
+    libhw {
+      library offload_bundle
+      uuid 79a18026-18fd-4185-8233-0002a5d5c51b
+    }
+  }
+  reverb_env_ins {
+    library proxy
+    uuid b707403a-a1c1-4291-9573-0002a5d5c51b
+
+    libsw {
+      library reverb
+      uuid c7a511a0-a3bb-11df-860e-0002a5d5c51b
+    }
+
+    libhw {
+      library offload_bundle
+      uuid eb64ea04-973b-43d2-8f5e-0002a5d5c51b
+    }
+  }
+  reverb_pre_aux {
+    library proxy
+    uuid 1b78f587-6d1c-422e-8b84-0002a5d5c51b
+
+    libsw {
+      library reverb
+      uuid f29a1400-a3bb-11df-8ddc-0002a5d5c51b
+    }
+
+    libhw {
+      library offload_bundle
+      uuid 6987be09-b142-4b41-9056-0002a5d5c51b
+    }
+  }
+  reverb_pre_ins {
+    library proxy
+    uuid f3e178d2-ebcb-408e-8357-0002a5d5c51b
+
+    libsw {
+      library reverb
+      uuid 172cdf00-a3bc-11df-a72f-0002a5d5c51b
+    }
+
+    libhw {
+      library offload_bundle
+      uuid aa2bebf6-47cf-4613-9bca-0002a5d5c51b
+    }
+  }
+  visualizer {
+    library proxy
+    uuid ec7178ec-e5e1-4432-a3f4-4657e6795210
+
+    libsw {
+      library visualizer_sw
+      uuid  d069d9e0-8329-11df-9168-0002a5d5c51b
+    }
+
+    libhw {
+      library visualizer_hw
+      uuid 7a8044a0-1a71-11e3-a184-0002a5d5c51b
+    }
+  }
+  downmix {
+    library downmix
+    uuid 93f04452-e4fe-41cc-91f9-e475b6d1d69f
+  }
+  loudness_enhancer {
+    library loudness_enhancer
+    uuid fa415329-2034-4bea-b5dc-5b381c8d1e2c
+  }
+}
+
+# Default pre-processing effects. Add to audio_effect.conf "effects" section if
+# audio HAL implements support for them.
+#
+#  agc {
+#    library pre_processing
+#    uuid aa8130e0-66fc-11e0-bad0-0002a5d5c51b
+#  }
+#  aec {
+#    library pre_processing
+#    uuid bb392ec0-8d4d-11e0-a896-0002a5d5c51b
+#  }
+#  ns {
+#    library pre_processing
+#    uuid c06c8400-8e06-11e0-9cb6-0002a5d5c51b
+#  }
+
+# Audio preprocessor configurations.
+# The pre processor configuration consists in a list of elements each describing
+# pre processor settings for a given input source. Valid input source names are:
+# "mic", "camcorder", "voice_recognition", "voice_communication"
+# Each input source element contains a list of effects elements. The name of the effect
+# element must be the name of one of the effects in the "effects" list of the file.
+# Each effect element may optionally contain a list of parameters and their
+# default value to apply when the pre processor effect is created.
+# A parameter is defined by a "param" element and a "value" element. Each of these elements
+# consists in one or more elements specifying a type followed by a value.
+# The types defined are: "int", "short", "float", "bool" and "string"
+# When both "param" and "value" are a single int, a simple form is allowed where just
+# the param and value pair is present in the parameter description
+#    pre_processing {
+#        <input source name> {
+#            <fx name> {
+#                <param 1 name> {
+#                    param {
+#                        int|short|float|bool|string <value>
+#                        [ int|short|float|bool|string <value> ]
+#                        ...
+#                    }
+#                    value {
+#                        int|short|float|bool|string <value>
+#                        [ int|short|float|bool|string <value> ]
+#                        ...
+#                    }
+#                }
+#                <param 2 name > {<param> <value>}
+#                ...
+#            }
+#            ...
+#        }
+#        ...
+#    }
+
+#
+# TODO: add default audio pre processor configurations after debug and tuning phase
+#
diff --git a/configs/audio_policy.conf b/configs/audio_policy.conf
new file mode 100644
index 0000000..480f878
--- /dev/null
+++ b/configs/audio_policy.conf
@@ -0,0 +1,107 @@
+# Global configuration section: lists input and output devices always present on the device
+# as well as the output device selected by default.
+# Devices are designated by a string that corresponds to the enum in audio.h
+
+global_configuration {
+  attached_output_devices AUDIO_DEVICE_OUT_EARPIECE|AUDIO_DEVICE_OUT_SPEAKER
+  default_output_device AUDIO_DEVICE_OUT_SPEAKER
+  attached_input_devices AUDIO_DEVICE_IN_BUILTIN_MIC|AUDIO_DEVICE_IN_BACK_MIC|AUDIO_DEVICE_IN_REMOTE_SUBMIX
+}
+
+# audio hardware module section: contains descriptors for all audio hw modules present on the
+# device. Each hw module node is named after the corresponding hw module library base name.
+# For instance, "primary" corresponds to audio.primary.<device>.so.
+# The "primary" module is mandatory and must include at least one output with
+# AUDIO_OUTPUT_FLAG_PRIMARY flag.
+# Each module descriptor contains one or more output profile descriptors and zero or more
+# input profile descriptors. Each profile lists all the parameters supported by a given output
+# or input stream category.
+# The "channel_masks", "formats", "devices" and "flags" are specified using strings corresponding
+# to enums in audio.h and audio_policy.h. They are concatenated by use of "|" without space or "\n".
+
+audio_hw_modules {
+  primary {
+    outputs {
+      primary {
+        sampling_rates 44100|48000
+        channel_masks AUDIO_CHANNEL_OUT_STEREO
+        formats AUDIO_FORMAT_PCM_16_BIT
+        devices AUDIO_DEVICE_OUT_EARPIECE|AUDIO_DEVICE_OUT_SPEAKER|AUDIO_DEVICE_OUT_WIRED_HEADSET|AUDIO_DEVICE_OUT_WIRED_HEADPHONE|AUDIO_DEVICE_OUT_ALL_SCO|AUDIO_DEVICE_OUT_AUX_DIGITAL|AUDIO_DEVICE_OUT_PROXY|AUDIO_DEVICE_OUT_ANLG_DOCK_HEADSET|AUDIO_DEVICE_OUT_DGTL_DOCK_HEADSET
+        flags AUDIO_OUTPUT_FLAG_PRIMARY
+      }
+      deep_buffer {
+         sampling_rates 8000|11025|12000|16000|22050|24000|32000|44100|48000
+         channel_masks AUDIO_CHANNEL_OUT_STEREO
+         formats AUDIO_FORMAT_PCM_16_BIT
+         devices AUDIO_DEVICE_OUT_SPEAKER|AUDIO_DEVICE_OUT_EARPIECE|AUDIO_DEVICE_OUT_WIRED_HEADSET|AUDIO_DEVICE_OUT_WIRED_HEADPHONE|AUDIO_DEVICE_OUT_ALL_SCO|AUDIO_DEVICE_OUT_AUX_DIGITAL|AUDIO_DEVICE_OUT_PROXY|AUDIO_DEVICE_OUT_ANLG_DOCK_HEADSET|AUDIO_DEVICE_OUT_DGTL_DOCK_HEADSET
+         flags AUDIO_OUTPUT_FLAG_DEEP_BUFFER
+      }
+      hdmi {
+        sampling_rates 44100|48000
+        channel_masks dynamic
+        formats AUDIO_FORMAT_PCM_16_BIT
+        devices AUDIO_DEVICE_OUT_AUX_DIGITAL
+        flags AUDIO_OUTPUT_FLAG_DIRECT
+      }
+      compress_offload {
+        sampling_rates 8000|11025|16000|22050|32000|44100|48000
+        channel_masks AUDIO_CHANNEL_OUT_MONO|AUDIO_CHANNEL_OUT_STEREO
+        formats AUDIO_FORMAT_MP3|AUDIO_FORMAT_AAC_LC|AUDIO_FORMAT_AAC_HE_V1|AUDIO_FORMAT_AAC_HE_V2
+        devices AUDIO_DEVICE_OUT_SPEAKER|AUDIO_DEVICE_OUT_WIRED_HEADSET|AUDIO_DEVICE_OUT_WIRED_HEADPHONE|AUDIO_DEVICE_OUT_PROXY|AUDIO_DEVICE_OUT_ANLG_DOCK_HEADSET|AUDIO_DEVICE_OUT_DGTL_DOCK_HEADSET
+        flags AUDIO_OUTPUT_FLAG_DIRECT|AUDIO_OUTPUT_FLAG_COMPRESS_OFFLOAD|AUDIO_OUTPUT_FLAG_NON_BLOCKING
+      }
+    }
+    inputs {
+      primary {
+        sampling_rates 8000|11025|12000|16000|22050|24000|32000|44100|48000
+        channel_masks AUDIO_CHANNEL_IN_MONO|AUDIO_CHANNEL_IN_STEREO|AUDIO_CHANNEL_IN_FRONT_BACK
+        formats AUDIO_FORMAT_PCM_16_BIT
+        devices AUDIO_DEVICE_IN_BUILTIN_MIC|AUDIO_DEVICE_IN_WIRED_HEADSET|AUDIO_DEVICE_IN_BLUETOOTH_SCO_HEADSET|AUDIO_DEVICE_IN_VOICE_CALL|AUDIO_DEVICE_IN_BACK_MIC
+      }
+    }
+  }
+  a2dp {
+    outputs {
+      a2dp {
+        sampling_rates 44100
+        channel_masks AUDIO_CHANNEL_OUT_STEREO
+        formats AUDIO_FORMAT_PCM_16_BIT
+        devices AUDIO_DEVICE_OUT_ALL_A2DP
+      }
+    }
+  }
+  usb {
+    outputs {
+      usb_accessory {
+        sampling_rates 44100
+        channel_masks AUDIO_CHANNEL_OUT_STEREO
+        formats AUDIO_FORMAT_PCM_16_BIT
+        devices AUDIO_DEVICE_OUT_USB_ACCESSORY
+      }
+      usb_device {
+        sampling_rates dynamic
+        channel_masks dynamic
+        formats dynamic
+        devices AUDIO_DEVICE_OUT_USB_DEVICE
+      }
+    }
+  }
+  r_submix {
+    outputs {
+      submix {
+        sampling_rates 48000
+        channel_masks AUDIO_CHANNEL_OUT_STEREO
+        formats AUDIO_FORMAT_PCM_16_BIT
+        devices AUDIO_DEVICE_OUT_REMOTE_SUBMIX
+      }
+    }
+    inputs {
+      submix {
+        sampling_rates 48000
+        channel_masks AUDIO_CHANNEL_IN_STEREO
+        formats AUDIO_FORMAT_PCM_16_BIT
+        devices AUDIO_DEVICE_IN_REMOTE_SUBMIX
+      }
+    }
+  }
+}
diff --git a/configs/media_codecs.xml b/configs/media_codecs.xml
new file mode 100644
index 0000000..ce49882
--- /dev/null
+++ b/configs/media_codecs.xml
@@ -0,0 +1,115 @@
+<?xml version="1.0" encoding="utf-8" ?>
+<!-- Copyright 2013 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
+
+<MediaCodecs>
+    <Include href="media_codecs_google_audio.xml" />
+    <Encoders>
+        <MediaCodec name="OMX.qcom.video.encoder.mpeg4" type="video/mp4v-es" >
+            <Quirk name="requires-allocate-on-input-ports" />
+            <Quirk name="requires-allocate-on-output-ports"/>
+            <Quirk name="requires-loaded-to-idle-after-allocation"/>
+            <Limit name="size" min="96x64" max="1920x1088" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="489600" />
+            <Limit name="bitrate" range="1-60000000" />
+        </MediaCodec>
+        <MediaCodec name="OMX.qcom.video.encoder.h263" type="video/3gpp" >
+            <Quirk name="requires-allocate-on-input-ports" />
+            <Quirk name="requires-allocate-on-output-ports"/>
+            <Quirk name="requires-loaded-to-idle-after-allocation"/>
+            <Limit name="size" min="96x64" max="720x576" />
+            <Limit name="alignment" value="2x2" />
+        </MediaCodec>
+        <MediaCodec name="OMX.qcom.video.encoder.avc" type="video/avc" >
+            <Quirk name="requires-allocate-on-input-ports" />
+            <Quirk name="requires-allocate-on-output-ports"/>
+            <Quirk name="requires-loaded-to-idle-after-allocation"/>
+            <Limit name="size" min="96x64" max="3840x2160" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="972000" />
+            <Limit name="bitrate" range="1-100000000" />
+        </MediaCodec>
+        <MediaCodec name="OMX.qcom.video.encoder.vp8" type="video/x-vnd.on2.vp8" >
+            <Quirk name="requires-allocate-on-input-ports" />
+            <Quirk name="requires-allocate-on-output-ports"/>
+            <Quirk name="requires-loaded-to-idle-after-allocation"/>
+            <Limit name="size" min="96x64" max="3840x2160" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="777600" />
+            <Limit name="bitrate" range="1-20000000" />
+        </MediaCodec>
+    </Encoders>
+    <Decoders>
+        <MediaCodec name="OMX.qcom.video.decoder.avc" type="video/avc" >
+            <Quirk name="requires-allocate-on-input-ports" />
+            <Quirk name="requires-allocate-on-output-ports"/>
+            <Quirk name="defers-output-buffer-allocation"/>
+            <Limit name="size" min="64x64" max="3840x2160" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="972000" />
+            <Limit name="bitrate" range="1-100000000" />
+            <Feature name="adaptive-playback" />
+        </MediaCodec>
+        <MediaCodec name="OMX.qcom.video.decoder.avc.secure" type="video/avc" >
+            <Quirk name="requires-allocate-on-input-ports" />
+            <Quirk name="requires-allocate-on-output-ports"/>
+            <Quirk name="defers-output-buffer-allocation"/>
+            <Limit name="size" min="64x64" max="3840x2160" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="972000" />
+            <Limit name="bitrate" range="1-100000000" />
+            <Feature name="adaptive-playback" />
+            <Feature name="secure-playback" required="true" />
+        </MediaCodec>
+        <MediaCodec name="OMX.qcom.video.decoder.mpeg4" type="video/mp4v-es" >
+            <Quirk name="requires-allocate-on-input-ports" />
+            <Quirk name="requires-allocate-on-output-ports"/>
+            <Quirk name="defers-output-buffer-allocation"/>
+            <Limit name="size" min="64x64" max="1920x1088" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="489600" />
+            <Limit name="bitrate" range="1-60000000" />
+            <Feature name="adaptive-playback" />
+        </MediaCodec>
+        <MediaCodec name="OMX.qcom.video.decoder.h263" type="video/3gpp" >
+            <Quirk name="requires-allocate-on-input-ports" />
+            <Quirk name="requires-allocate-on-output-ports"/>
+            <Quirk name="defers-output-buffer-allocation"/>
+            <Limit name="size" min="64x64" max="720x576" />
+            <Limit name="alignment" value="2x2" />
+            <Feature name="adaptive-playback" />
+        </MediaCodec>
+        <MediaCodec name="OMX.qcom.video.decoder.vp8" type="video/x-vnd.on2.vp8" >
+            <Quirk name="requires-allocate-on-input-ports" />
+            <Quirk name="requires-allocate-on-output-ports" />
+            <Quirk name="defers-output-buffer-allocation" />
+            <Limit name="size" min="64x64" max="3840x2160" />
+            <Limit name="alignment" value="2x2" />
+            <Limit name="block-size" value="16x16" />
+            <Limit name="blocks-per-second" min="1" max="777600" />
+            <Limit name="bitrate" range="1-20000000" />
+            <Feature name="adaptive-playback" />
+        </MediaCodec>
+    </Decoders>
+    <Include href="media_codecs_google_video.xml" />
+    <Include href="media_codecs_ffmpeg.xml" />
+</MediaCodecs>
diff --git a/configs/media_profiles.xml b/configs/media_profiles.xml
new file mode 100644
index 0000000..0935bbc
--- /dev/null
+++ b/configs/media_profiles.xml
@@ -0,0 +1,428 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright 2013 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
+<!DOCTYPE MediaSettings [
+<!ELEMENT MediaSettings (CamcorderProfiles,
+                         EncoderOutputFileFormat+,
+                         VideoEncoderCap+,
+                         AudioEncoderCap+,
+                         VideoDecoderCap,
+                         AudioDecoderCap)>
+<!ELEMENT CamcorderProfiles (EncoderProfile+, ImageEncoding+, ImageDecoding, Camera)>
+<!ELEMENT EncoderProfile (Video, Audio)>
+<!ATTLIST EncoderProfile quality (high|low) #REQUIRED>
+<!ATTLIST EncoderProfile fileFormat (mp4|3gp) #REQUIRED>
+<!ATTLIST EncoderProfile duration (30|60) #REQUIRED>
+<!ATTLIST EncoderProfile cameraId (0|1) #REQUIRED>
+<!ELEMENT Video EMPTY>
+<!ATTLIST Video codec (h264|h263|m4v) #REQUIRED>
+<!ATTLIST Video bitRate CDATA #REQUIRED>
+<!ATTLIST Video width CDATA #REQUIRED>
+<!ATTLIST Video height CDATA #REQUIRED>
+<!ATTLIST Video frameRate CDATA #REQUIRED>
+<!ELEMENT Audio EMPTY>
+<!ATTLIST Audio codec (amrnb|amrwb|aac) #REQUIRED>
+<!ATTLIST Audio bitRate CDATA #REQUIRED>
+<!ATTLIST Audio sampleRate CDATA #REQUIRED>
+<!ATTLIST Audio channels (1|2) #REQUIRED>
+<!ELEMENT ImageEncoding EMPTY>
+<!ATTLIST ImageEncoding quality (90|80|70|60|50|40) #REQUIRED>
+<!ELEMENT ImageDecoding EMPTY>
+<!ATTLIST ImageDecoding memCap CDATA #REQUIRED>
+<!ELEMENT Camera EMPTY>
+<!ELEMENT EncoderOutputFileFormat EMPTY>
+<!ATTLIST EncoderOutputFileFormat name (mp4|3gp) #REQUIRED>
+<!ELEMENT VideoEncoderCap EMPTY>
+<!ATTLIST VideoEncoderCap name (h264|h263|m4v|wmv) #REQUIRED>
+<!ATTLIST VideoEncoderCap enabled (true|false) #REQUIRED>
+<!ATTLIST VideoEncoderCap minBitRate CDATA #REQUIRED>
+<!ATTLIST VideoEncoderCap maxBitRate CDATA #REQUIRED>
+<!ATTLIST VideoEncoderCap minFrameWidth CDATA #REQUIRED>
+<!ATTLIST VideoEncoderCap maxFrameWidth CDATA #REQUIRED>
+<!ATTLIST VideoEncoderCap minFrameHeight CDATA #REQUIRED>
+<!ATTLIST VideoEncoderCap maxFrameHeight CDATA #REQUIRED>
+<!ATTLIST VideoEncoderCap minFrameRate CDATA #REQUIRED>
+<!ATTLIST VideoEncoderCap maxFrameRate CDATA #REQUIRED>
+<!ELEMENT AudioEncoderCap EMPTY>
+<!ATTLIST AudioEncoderCap name (amrnb|amrwb|aac|wma) #REQUIRED>
+<!ATTLIST AudioEncoderCap enabled (true|false) #REQUIRED>
+<!ATTLIST AudioEncoderCap minBitRate CDATA #REQUIRED>
+<!ATTLIST AudioEncoderCap maxBitRate CDATA #REQUIRED>
+<!ATTLIST AudioEncoderCap minSampleRate CDATA #REQUIRED>
+<!ATTLIST AudioEncoderCap maxSampleRate CDATA #REQUIRED>
+<!ATTLIST AudioEncoderCap minChannels (1|2) #REQUIRED>
+<!ATTLIST AudioEncoderCap maxChannels (1|2) #REQUIRED>
+<!ELEMENT VideoDecoderCap EMPTY>
+<!ATTLIST VideoDecoderCap name (wmv) #REQUIRED>
+<!ATTLIST VideoDecoderCap enabled (true|false) #REQUIRED>
+<!ELEMENT AudioDecoderCap EMPTY>
+<!ATTLIST AudioDecoderCap name (wma) #REQUIRED>
+<!ATTLIST AudioDecoderCap enabled (true|false) #REQUIRED>
+<!ELEMENT VideoEditorCap EMPTY>
+<!ATTLIST VideoEditorCap maxInputFrameWidth CDATA #REQUIRED>
+<!ATTLIST VideoEditorCap maxInputFrameHeight CDATA #REQUIRED>
+<!ATTLIST VideoEditorCap maxOutputFrameWidth CDATA #REQUIRED>
+<!ATTLIST VideoEditorCap maxOutputFrameHeight CDATA #REQUIRED>
+<!ATTLIST VideoEditorCap maxPrefetchYUVFrames CDATA #REQUIRED>
+<!ELEMENT ExportVideoProfile EMPTY>
+<!ATTLIST ExportVideoProfile name (h264|h263|m4v) #REQUIRED>
+<!ATTLIST ExportVideoProfile profile CDATA #REQUIRED>
+<!ATTLIST ExportVideoProfile level CDATA #REQUIRED>
+]>
+<!--
+     This file is used to declare the multimedia profiles and capabilities
+     on an android-powered device.
+-->
+<MediaSettings>
+    <!-- Each camcorder profile defines a set of predefined configuration parameters -->
+    <CamcorderProfiles cameraId="0">
+
+        <EncoderProfile quality="qvga" fileFormat="3gp" duration="60">
+            <Video codec="m4v"
+                   bitRate="128000"
+                   width="320"
+                   height="240"
+                   frameRate="15" />
+            <Audio codec="amrnb"
+                   bitRate="12200"
+                   sampleRate="8000"
+                   channels="1" />
+        </EncoderProfile>
+
+        <EncoderProfile quality="cif" fileFormat="mp4" duration="30">
+            <Video codec="h264"
+                   bitRate="1200000"
+                   width="352"
+                   height="288"
+                   frameRate="30" />
+            <Audio codec="aac"
+                   bitRate="96000"
+                   sampleRate="48000"
+                   channels="1" />
+        </EncoderProfile>
+
+        <EncoderProfile quality="480p" fileFormat="mp4" duration="30">
+            <Video codec="h264"
+                   bitRate="6000000"
+                   width="720"
+                   height="480"
+                   frameRate="30" />
+            <Audio codec="aac"
+                   bitRate="96000"
+                   sampleRate="48000"
+                   channels="1" />
+        </EncoderProfile>
+
+        <EncoderProfile quality="720p" fileFormat="mp4" duration="30">
+            <Video codec="h264"
+                   bitRate="12000000"
+                   width="1280"
+                   height="720"
+                   frameRate="30" />
+            <Audio codec="aac"
+                   bitRate="96000"
+                   sampleRate="48000"
+                   channels="1" />
+        </EncoderProfile>
+
+        <EncoderProfile quality="1080p" fileFormat="mp4" duration="30">
+            <Video codec="h264"
+                   bitRate="17000000"
+                   width="1920"
+                   height="1080"
+                   frameRate="30" />
+            <Audio codec="aac"
+                   bitRate="96000"
+                   sampleRate="48000"
+                   channels="1" />
+        </EncoderProfile>
+
+        <EncoderProfile quality="timelapseqcif" fileFormat="mp4" duration="30">
+            <Video codec="h264"
+                   bitRate="192000"
+                   width="176"
+                   height="144"
+                   frameRate="30" />
+            <!-- audio setting is ignored -->
+            <Audio codec="amrnb"
+                   bitRate="12200"
+                   sampleRate="8000"
+                   channels="1" />
+        </EncoderProfile>
+
+        <EncoderProfile quality="timelapsecif" fileFormat="mp4" duration="30">
+            <Video codec="h264"
+                   bitRate="1200000"
+                   width="352"
+                   height="288"
+                   frameRate="30" />
+            <!-- audio setting is ignored -->
+            <Audio codec="aac"
+                   bitRate="96000"
+                   sampleRate="48000"
+                   channels="1" />
+        </EncoderProfile>
+
+        <EncoderProfile quality="timelapse480p" fileFormat="mp4" duration="30">
+            <Video codec="h264"
+                   bitRate="6000000"
+                   width="720"
+                   height="480"
+                   frameRate="30" />
+            <!-- audio setting is ignored -->
+            <Audio codec="aac"
+                   bitRate="96000"
+                   sampleRate="48000"
+                   channels="1" />
+        </EncoderProfile>
+
+        <EncoderProfile quality="timelapse720p" fileFormat="mp4" duration="30">
+            <Video codec="h264"
+                   bitRate="12000000"
+                   width="1280"
+                   height="720"
+                   frameRate="30" />
+            <!-- audio setting is ignored -->
+            <Audio codec="aac"
+                   bitRate="96000"
+                   sampleRate="48000"
+                   channels="1" />
+        </EncoderProfile>
+
+        <EncoderProfile quality="timelapse1080p" fileFormat="mp4" duration="30">
+            <Video codec="h264"
+                   bitRate="17000000"
+                   width="1920"
+                   height="1080"
+                   frameRate="30" />
+            <!-- audio setting is ignored -->
+            <Audio codec="aac"
+                   bitRate="96000"
+                   sampleRate="48000"
+                   channels="1" />
+        </EncoderProfile>
+
+        <ImageEncoding quality="95" />
+        <ImageEncoding quality="80" />
+        <ImageEncoding quality="70" />
+        <ImageDecoding memCap="20000000" />
+
+    </CamcorderProfiles>
+
+    <CamcorderProfiles cameraId="1">
+
+        <EncoderProfile quality="qvga" fileFormat="3gp" duration="60">
+            <Video codec="m4v"
+                   bitRate="128000"
+                   width="320"
+                   height="240"
+                   frameRate="15" />
+            <Audio codec="amrnb"
+                   bitRate="12200"
+                   sampleRate="8000"
+                   channels="1" />
+        </EncoderProfile>
+
+        <EncoderProfile quality="cif" fileFormat="mp4" duration="30">
+            <Video codec="h264"
+                   bitRate="1200000"
+                   width="352"
+                   height="288"
+                   frameRate="30" />
+            <Audio codec="aac"
+                   bitRate="96000"
+                   sampleRate="48000"
+                   channels="1" />
+        </EncoderProfile>
+
+        <EncoderProfile quality="480p" fileFormat="mp4" duration="30">
+            <Video codec="h264"
+                   bitRate="6000000"
+                   width="720"
+                   height="480"
+                   frameRate="30" />
+            <Audio codec="aac"
+                   bitRate="96000"
+                   sampleRate="48000"
+                   channels="1" />
+        </EncoderProfile>
+
+        <EncoderProfile quality="720p" fileFormat="mp4" duration="30">
+            <Video codec="h264"
+                   bitRate="12000000"
+                   width="1280"
+                   height="720"
+                   frameRate="30" />
+            <Audio codec="aac"
+                   bitRate="96000"
+                   sampleRate="48000"
+                   channels="1" />
+        </EncoderProfile>
+
+        <EncoderProfile quality="timelapseqcif" fileFormat="mp4" duration="30">
+            <Video codec="h264"
+                   bitRate="192000"
+                   width="176"
+                   height="144"
+                   frameRate="30" />
+            <!-- audio setting is ignored -->
+            <Audio codec="amrnb"
+                   bitRate="12200"
+                   sampleRate="8000"
+                   channels="1" />
+        </EncoderProfile>
+
+        <EncoderProfile quality="timelapsecif" fileFormat="mp4" duration="30">
+            <Video codec="h264"
+                   bitRate="1200000"
+                   width="352"
+                   height="288"
+                   frameRate="30" />
+            <!-- audio setting is ignored -->
+            <Audio codec="aac"
+                   bitRate="96000"
+                   sampleRate="48000"
+                   channels="1" />
+        </EncoderProfile>
+
+        <EncoderProfile quality="timelapse480p" fileFormat="mp4" duration="30">
+            <Video codec="h264"
+                   bitRate="6000000"
+                   width="720"
+                   height="480"
+                   frameRate="30" />
+            <!-- audio setting is ignored -->
+            <Audio codec="aac"
+                   bitRate="96000"
+                   sampleRate="48000"
+                   channels="1" />
+        </EncoderProfile>
+
+        <EncoderProfile quality="timelapse720p" fileFormat="mp4" duration="30">
+            <Video codec="h264"
+                   bitRate="12000000"
+                   width="1280"
+                   height="720"
+                   frameRate="30" />
+            <!-- audio setting is ignored -->
+            <Audio codec="aac"
+                   bitRate="96000"
+                   sampleRate="48000"
+                   channels="1" />
+        </EncoderProfile>
+
+        <ImageEncoding quality="95" />
+        <ImageEncoding quality="80" />
+        <ImageEncoding quality="70" />
+        <ImageDecoding memCap="20000000" />
+
+    </CamcorderProfiles>
+
+    <EncoderOutputFileFormat name="3gp" />
+    <EncoderOutputFileFormat name="mp4" />
+
+    <!--
+         If a codec is not enabled, it is invisible to the applications
+         In other words, the applications won't be able to use the codec
+         or query the capabilities of the codec at all if it is disabled
+    -->
+    <VideoEncoderCap name="h264" enabled="true"
+        minBitRate="64000" maxBitRate="40000000"
+        minFrameWidth="176" maxFrameWidth="1920"
+        minFrameHeight="144" maxFrameHeight="1080"
+        minFrameRate="15" maxFrameRate="30" />
+
+    <VideoEncoderCap name="h263" enabled="true"
+        minBitRate="64000" maxBitRate="2000000"
+        minFrameWidth="176" maxFrameWidth="800"
+        minFrameHeight="144" maxFrameHeight="480"
+        minFrameRate="15" maxFrameRate="30" />
+
+    <VideoEncoderCap name="m4v" enabled="true"
+        minBitRate="64000" maxBitRate="40000000"
+        minFrameWidth="176" maxFrameWidth="1920"
+        minFrameHeight="144" maxFrameHeight="1080"
+        minFrameRate="15" maxFrameRate="30" />
+
+    <AudioEncoderCap name="aac" enabled="true"
+        minBitRate="758" maxBitRate="288000"
+        minSampleRate="8000" maxSampleRate="48000"
+        minChannels="1" maxChannels="1" />
+
+    <AudioEncoderCap name="heaac" enabled="true"
+        minBitRate="8000" maxBitRate="64000"
+        minSampleRate="16000" maxSampleRate="48000"
+        minChannels="1" maxChannels="1" />
+
+    <AudioEncoderCap name="aaceld" enabled="true"
+        minBitRate="16000" maxBitRate="192000"
+        minSampleRate="16000" maxSampleRate="48000"
+        minChannels="1" maxChannels="1" />
+
+    <AudioEncoderCap name="amrwb" enabled="true"
+        minBitRate="6600" maxBitRate="23050"
+        minSampleRate="16000" maxSampleRate="16000"
+        minChannels="1" maxChannels="1" />
+
+    <AudioEncoderCap name="amrnb" enabled="true"
+        minBitRate="5525" maxBitRate="12200"
+        minSampleRate="8000" maxSampleRate="8000"
+        minChannels="1" maxChannels="1" />
+
+    <!--
+        FIXME:
+        We do not check decoder capabilities at present
+        At present, we only check whether windows media is visible
+        for TEST applications. For other applications, we do
+        not perform any checks at all.
+    -->
+    <VideoDecoderCap name="wmv" enabled="false"/>
+    <AudioDecoderCap name="wma" enabled="false"/>
+
+    <!--
+        The VideoEditor Capability configuration:
+        - maxInputFrameWidth: maximum video width of imported video clip.
+        - maxInputFrameHeight: maximum video height of imported video clip.
+        - maxOutputFrameWidth: maximum video width of exported video clip.
+        - maxOutputFrameHeight: maximum video height of exported video clip.
+        - maxPrefetchYUVFrames: maximum prefetch YUV frames for encoder,
+        used to limit the amount of memory for prefetched YUV frames.
+        For this platform, it allows maximum 30MB(3MB per 1080p frame x 10
+        frames) memory.
+    -->
+    <VideoEditorCap  maxInputFrameWidth="1920"
+        maxInputFrameHeight="1080" maxOutputFrameWidth="1920"
+        maxOutputFrameHeight="1080" maxPrefetchYUVFrames="10"/>
+    <!--
+        The VideoEditor Export codec profile and level values
+        correspond to the values in OMX_Video.h.
+        E.g. for h264, profile value 1 means OMX_VIDEO_AVCProfileBaseline
+        and  level 4096 means OMX_VIDEO_AVCLevel41.
+        Please note that the values are in decimal.
+        These values are for video encoder.
+    -->
+    <!--
+      Codec = h.264, Baseline profile, level 4.0
+    -->
+    <ExportVideoProfile name="h264" profile= "1" level="2048"/>
+    <!--
+      Codec = h.263, Baseline profile, level 70
+    -->
+    <ExportVideoProfile name="h263" profile= "1" level="128"/>
+    <!--
+      Codec = mpeg4, Simple profile, level 5
+    -->
+    <ExportVideoProfile name="m4v" profile= "1" level="128"/>
+</MediaSettings>
diff --git a/hdx-common.mk b/hdx-common.mk
index 762d6aa..a76042f 100755
--- a/hdx-common.mk
+++ b/hdx-common.mk
@@ -57,7 +57,17 @@ PRODUCT_PACKAGES += \
 # fix libqc-opt.so (missing "utext_openUChars_51" import from stagefright 4.X)
 # https://github.com/TheMuppets/proprietary_vendor_samsung/blob/cm-12.0/d2-common/proprietary/lib/libqc-opt.so
 PRODUCT_COPY_FILES += \
-	$(COMMON_FOLDER)/overlay-binaries/libqc-opt.so:system/vendor/lib/libqc-opt.so	
+	$(COMMON_FOLDER)/overlay-binaries/libqc-opt.so:system/vendor/lib/libqc-opt.so
+
+# Media
+PRODUCT_COPY_FILES += \
+    $(LOCAL_PATH)/configs/audio_policy.conf:system/etc/audio_policy.conf \
+    $(LOCAL_PATH)/configs/media_profiles.xml:system/etc/media_profiles.xml \
+    frameworks/av/media/libstagefright/data/media_codecs_google_audio.xml:system/etc/media_codecs_google_audio.xml \
+    frameworks/av/media/libstagefright/data/media_codecs_google_video.xml:system/etc/media_codecs_google_video.xml \
+    frameworks/av/media/libstagefright/data/media_codecs_ffmpeg.xml:system/etc/media_codecs_ffmpeg.xml \
+    $(LOCAL_PATH)/configs/media_codecs.xml:system/etc/media_codecs.xml
+ #   $(LOCAL_PATH)/configs/mixer_paths.xml:system/etc/mixer_paths.xml
 
 # Audio
 PRODUCT_PACKAGES += \
@@ -71,6 +81,9 @@ PRODUCT_PACKAGES += \
     libqcomvisualizer \
     libqcomvoiceprocessing
 
+PRODUCT_COPY_FILES += \
+        $(LOCAL_PATH)/configs/audio_effects.conf:system/vendor/etc/audio_effects.conf
+
 # Charger
 PRODUCT_PACKAGES += \
     charger \
@@ -203,24 +216,6 @@ PRODUCT_PROPERTY_OVERRIDES += \
 	dev.pm.dyn_samplingrate=1 \
 	persist.demo.hdmirotationlock=false \
 	ro.hdmi.enable=true \
-	tunnel.decode=true \
-	tunnel.audiovideo.decode=true \
-	lpa.decode=false \
-	lpa.use-stagefright=true \
-	persist.speaker.prot.enable=false \
-	qcom.hw.aac.encoder=false \
-	persist.cne.feature=0 \
-	media.stagefright.enable-player=true \
-	media.stagefright.enable-http=true \
-	media.stagefright.enable-aac=true \
-	media.stagefright.enable-qcp=true \
-	media.stagefright.enable-fma2dp=true \
-	media.stagefright.enable-scan=true \
-	mmp.enable.3g2=true \
-	mm.enable.smoothstreaming=true \
-	media.aac_51_output_enabled=true \
-	mm.enable.qcom_parser=37491 \
-	vidc.debug.level=1 \
 	ro.use_data_netmgrd=true \
 	persist.data.netmgrd.qos.enable=true \
 	ro.data.large_tcp_window_size=true \
@@ -228,11 +223,6 @@ PRODUCT_PROPERTY_OVERRIDES += \
 	ro.qualcomm.cabl=1 \
 	telephony.lteOnCdmaDevice=0 \
 	persist.fuse_sdcard=true \
-	ro.qc.sdk.audio.ssr=false \
-	ro.qc.sdk.audio.fluencetype=none \
-	persist.audio.fluence.voicecall=true \
-	persist.audio.fluence.voicerec=false \
-	persist.audio.fluence.speaker=true \
 	ro.qc.sdk.sensors.gestures=true \
 	ro.qc.sdk.gestures.camera=false \
 	ro.qc.sdk.camera.facialproc=false \
@@ -240,14 +230,6 @@ PRODUCT_PROPERTY_OVERRIDES += \
 	ro.qcom.ad.calib.data=/system/etc/ad_calib.cfg \
 	persist.debug.wfd.enable=1 \
 	persist.sys.wfd.virtual=0 \
-	tunnel.audio.encode = true \
-	af.resampler.quality=4 \
-	audio.offload.buffer.size.kb=32 \
-	av.offload.enable=true \
-	dmid=1932882026 \
-	dolby.ds.platform=qcom \
-	audio.offload.pcm.enable=true \
-	audio.dolby.ds2.enabled=true \
 	ro.usb.vid=1949 \
 	ro.usb.pid=000c \
 	persist.sys.usb.config=mtp,adb \
@@ -259,16 +241,22 @@ PRODUCT_PROPERTY_OVERRIDES += \
 	ro.ril.usb.port.rmnet=rmnet_usb \
 	telephony.sms.receive=true \
 	keyguard.ori.timeout=350
-#	ro.camera.model=Kindle Fire HDX 7" \
-
-#	DISABLE calfiles as audio volume is too loud
-#	persist.audio.calfile0=/etc/acdbdata/THOR/Bluetooth_cal.acdb \
-#	persist.audio.calfile1=/etc/acdbdata/THOR/General_cal.acdb \
-#	persist.audio.calfile2=/etc/acdbdata/THOR/Global_cal.acdb \
-#	persist.audio.calfile3=/etc/acdbdata/THOR/Handset_cal.acdb \
-#	persist.audio.calfile4=/etc/acdbdata/THOR/Hdmi_cal.acdb \
-#	persist.audio.calfile5=/etc/acdbdata/THOR/Headset_cal.acdb \
-#	persist.audio.calfile6=/etc/acdbdata/THOR/Speaker_cal.acdb \
+
+# audio/media props
+PRODUCT_PROPERTY_OVERRIDES += \
+	persist.audio.calfile0=/etc/acdbdata/THOR/Bluetooth_cal.acdb \
+	persist.audio.calfile1=/etc/acdbdata/THOR/General_cal.acdb \
+	persist.audio.calfile2=/etc/acdbdata/THOR/Global_cal.acdb \
+	persist.audio.calfile3=/etc/acdbdata/THOR/Handset_cal.acdb \
+	persist.audio.calfile4=/etc/acdbdata/THOR/Hdmi_cal.acdb \
+	persist.audio.calfile5=/etc/acdbdata/THOR/Headset_cal.acdb \
+	persist.audio.calfile6=/etc/acdbdata/THOR/Speaker_cal.acdb \
+	media.aac_51_output_enabled=true \
+	vidc.debug.level=1 \
+	persist.audio.fluence.voicecall=true \
+	audio.offload.buffer.size.kb=32 \
+	av.offload.enable=true
+
 
 PRODUCT_BUILD_PROP_OVERRIDES += BUILD_UTC_DATE=0
 
diff --git a/overlay-common/frameworks/base/core/res/res/values/config.xml b/overlay-common/frameworks/base/core/res/res/values/config.xml
index 76de9e7..8589854 100644
--- a/overlay-common/frameworks/base/core/res/res/values/config.xml
+++ b/overlay-common/frameworks/base/core/res/res/values/config.xml
@@ -45,12 +45,12 @@
     </integer-array>
 
     <integer-array name="config_autoBrightnessLcdBacklightValues">
+        <item>1</item>
+        <item>5</item>
         <item>10</item>
-        <item>15</item>
-        <item>30</item>
-        <item>50</item>
-        <item>70</item>
-        <item>90</item>
+        <item>25</item>
+        <item>40</item>
+        <item>75</item>
         <item>100</item>
         <item>120</item>
         <item>139</item>
-- 
1.9.1

